<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 1: AI Fundamentals - AI Literacy Learning</title>
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/modules.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>Module 1: AI Fundamentals</h1>
            </div>
            <div class="nav-user">
                <button class="back-btn" onclick="moduleManager.goBack()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M12 5L7 10L12 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    Back to Dashboard
                </button>
            </div>
        </div>
    </nav>

    <div class="module-page">
        <div class="module-content">
            <!-- Enhanced Module Header with Image -->
            <div class="module-hero-container">
                <div class="module-hero-image">
                    <!-- Placeholder for module image -->
                    <div class="image-placeholder">
                        <svg width="100" height="100" viewBox="0 0 100 100" fill="none" class="placeholder-icon">
                            <rect x="10" y="10" width="80" height="60" rx="8" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            <circle cx="30" cy="30" r="8" fill="currentColor" opacity="0.3"/>
                            <path d="M10 60L35 40L50 50L90 20V70H10V60Z" fill="currentColor" opacity="0.3"/>
                        </svg>
                        <p class="placeholder-text">Module Image</p>
                    </div>
                </div>
                
                <!-- Overlaid Title (Top Left) -->
                <div class="module-title-overlay">
                    <button class="back-btn-overlay" onclick="window.location.href='../../index.html'">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M8 16L0 8L8 0L9.4 1.4L3.8 7H16V9H3.8L9.4 14.6L8 16Z" fill="currentColor"/>
                        </svg>
                        Back
                    </button>
                    <div class="module-meta-overlay">
                        <span class="module-number">Module 01</span>
                        <span class="module-duration">~2 hours</span>
                    </div>
                    <h1 class="module-title-main">AI Fundamentals</h1>
                    <p class="module-description-overlay">Build a solid understanding of artificial intelligence, machine learning, and how AI impacts our daily lives.</p>
                </div>
                
                <!-- Progress Bar (Bottom) -->
                <div class="module-progress-overlay">
                    <div class="progress-info-overlay">
                        <span class="progress-text-overlay">0% Complete</span>
                    </div>
                    <div class="progress-bar-overlay">
                        <div class="progress-fill-overlay module-progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Start Unit Button -->
                <div class="start-unit-container">
                    <button class="start-unit-btn" onclick="startUnit()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="start-icon">
                            <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                        </svg>
                        Start Unit
                    </button>
                </div>
            </div>

            <div class="module-flow">
                <!-- Video 1 -->
                <div class="content-section">
                    <div class="video-section">
                        <div class="video-player">
                            <div class="play-btn">
                                <svg width="30" height="30" viewBox="0 0 30 30" fill="none">
                                    <path d="M10 7L22 15L10 23V7Z" fill="currentColor"/>
                                </svg>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">What is AI?</h3>
                            <p class="video-description">Learn the fundamentals of artificial intelligence and how it differs from traditional programming.</p>
                            <span class="video-duration">Duration: 10:30</span>
                        </div>
                    </div>
                </div>

                <!-- Video 2 -->
                <div class="content-section">
                    <div class="video-section">
                        <div class="video-player">
                            <div class="play-btn">
                                <svg width="30" height="30" viewBox="0 0 30 30" fill="none">
                                    <path d="M10 7L22 15L10 23V7Z" fill="currentColor"/>
                                </svg>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">Can AI Lie?</h3>
                            <p class="video-description">Explore how AI systems sometimes give wrong information and learn to identify AI "hallucinations".</p>
                            <span class="video-duration">Duration: 12:15</span>
                        </div>
                    </div>
                    
                    <!-- Activity Button after Video 2 -->
                    <div class="activity-button-section">
                        <button class="activity-button" onclick="openActivityWindow('truth-hallucination')">
                            <div class="activity-thumbnail">
                                <svg width="40" height="40" viewBox="0 0 60 60" fill="none">
                                    <rect x="10" y="10" width="40" height="40" rx="8" stroke="currentColor" stroke-width="2"/>
                                    <circle cx="25" cy="25" r="8" fill="currentColor"/>
                                    <rect x="35" y="35" width="10" height="10" fill="currentColor"/>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <h4>Truth or Hallucination?</h4>
                                <p>Learn to identify when AI gives accurate vs. incorrect information</p>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Video 3 -->
                <div class="content-section">
                    <div class="video-section">
                        <div class="video-player">
                            <div class="play-btn">
                                <svg width="30" height="30" viewBox="0 0 30 30" fill="none">
                                    <path d="M10 7L22 15L10 23V7Z" fill="currentColor"/>
                                </svg>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">AI in Your Daily Life</h3>
                            <p class="video-description">Explore real-world examples of AI that you encounter every day.</p>
                            <span class="video-duration">Duration: 8:45</span>
                        </div>
                    </div>
                </div>

                <!-- Video 4 -->
                <div class="content-section">
                    <div class="video-section">
                        <div class="video-player">
                            <div class="play-btn">
                                <svg width="30" height="30" viewBox="0 0 30 30" fill="none">
                                    <path d="M10 7L22 15L10 23V7Z" fill="currentColor"/>
                                </svg>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">AI Ethics and Bias</h3>
                            <p class="video-description">Understand the ethical implications and potential biases in AI systems.</p>
                            <span class="video-duration">Duration: 9:00</span>
                        </div>
                    </div>
                    
                </div>

                <!-- AI Bias Experience -->
                <div class="content-section">
                    <div class="activity-button-section">
                        <button class="activity-button" onclick="openActivityWindow('bias-experience')">
                            <div class="activity-thumbnail">
                                <svg width="40" height="40" viewBox="0 0 60 60" fill="none">
                                    <circle cx="30" cy="25" r="15" stroke="currentColor" stroke-width="2"/>
                                    <path d="M15 45C15 35 21 30 30 30C39 30 45 35 45 45" stroke="currentColor" stroke-width="2"/>
                                    <path d="M25 20L35 20M25 25L35 25" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <h4>AI Bias Experience</h4>
                                <p>Explore how bias can affect AI decisions and learn to identify it</p>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Module Assessment -->
                <div class="content-section">
                    <div class="assessment-button-section">
                        <button class="assessment-button" onclick="openActivityWindow('assessment')">
                            <div class="assessment-thumbnail">
                                <svg width="40" height="40" viewBox="0 0 60 60" fill="none">
                                    <rect x="15" y="10" width="30" height="40" rx="4" stroke="currentColor" stroke-width="2"/>
                                    <path d="M20 20L25 25L35 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="20" y1="30" x2="40" y2="30" stroke="currentColor" stroke-width="2"/>
                                    <line x1="20" y1="35" x2="35" y2="35" stroke="currentColor" stroke-width="2"/>
                                    <line x1="20" y1="40" x2="40" y2="40" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="assessment-content">
                                <h4>Module Assessment</h4>
                                <p>Test your knowledge with a comprehensive quiz on AI fundamentals</p>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Hidden containers for activities and quiz -->
                <div class="hidden-content" id="activities" style="display: none;">
                    <div class="activities-container">
                        <!-- Activities will be loaded by JavaScript -->
                    </div>
                </div>

                <div class="hidden-content" id="quiz" style="display: none;">
                    <div class="quiz-container">
                        <div class="quiz-progress">
                            <span>Question <span id="current-question">1</span> of <span id="total-questions">3</span></span>
                            <div class="quiz-progress-bar">
                                <div class="quiz-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="question-container" id="question-container">
                            <!-- Quiz questions will be loaded by JavaScript -->
                        </div>
                        <div class="quiz-actions">
                            <button class="quiz-btn" id="prev-btn" onclick="previousQuestion()" disabled>Previous</button>
                            <button class="quiz-btn" id="next-btn" onclick="nextQuestion()">Next</button>
                            <button class="quiz-btn" id="submit-btn" onclick="submitQuiz()" style="display: none;">Submit Quiz</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../../js/modules.js"></script>
    <script src="../../js/activities.js"></script>
    <script src="../../js/progress.js"></script>
    <script>
        // Initialize module
        const currentModuleId = 1;
        
        // Quiz state
        let currentQuestionIndex = 0;
        let quizAnswers = {};
        
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize progress tracking first
            if (window.progressTracker) {
                window.progressTracker.initializeProgress();
            }
            
            moduleManager.initializeModulePage(currentModuleId);
            loadQuizQuestions();
            
            // Initialize sidebar
            if (moduleManager.createLessonViewer) {
                moduleManager.createLessonViewer();
                // Open the sidebar and load content
                setTimeout(() => {
                    if (moduleManager.openLessonSidebar) {
                        moduleManager.openLessonSidebar(currentModuleId);
                    }
                }, 50);
            }
            
            // Debug: Check if moduleContent is now available
            console.log('DOM loaded - window.moduleContent:', window.moduleContent);
        });
        
        // Quiz functions
        function loadQuiz(moduleId, quiz) {
            // Implementation for loading quiz - placeholder for now
            console.log('Loading quiz for module:', moduleId);
        }
        
        function loadQuizQuestions() {
            const questions = window.moduleContent[1].quiz.questions;
            showQuestion(0);
        }
        
        function showQuestion(index) {
            const questions = window.moduleContent[1].quiz.questions;
            const question = questions[index];
            const container = document.getElementById('question-container');
            
            container.innerHTML = `
                <h3 class="question-text">${question.text}</h3>
                <div class="answer-options">
                    ${question.options.map((option, i) => `
                        <div class="answer-option ${quizAnswers[question.id] === i ? 'selected' : ''}" 
                             onclick="selectAnswer('${question.id}', ${i})">
                            ${option}
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Update progress
            document.getElementById('current-question').textContent = index + 1;
            document.getElementById('total-questions').textContent = questions.length;
            document.querySelector('.quiz-progress-fill').style.width = `${((index + 1) / questions.length) * 100}%`;
            
            // Update buttons
            document.getElementById('prev-btn').disabled = index === 0;
            document.getElementById('next-btn').style.display = index === questions.length - 1 ? 'none' : 'inline-block';
            document.getElementById('submit-btn').style.display = index === questions.length - 1 ? 'inline-block' : 'none';
        }
        
        function selectAnswer(questionId, answerIndex) {
            quizAnswers[questionId] = answerIndex;
            
            // Update UI
            document.querySelectorAll('.answer-option').forEach((option, i) => {
                option.classList.toggle('selected', i === answerIndex);
            });
        }
        
        function nextQuestion() {
            const questions = window.moduleContent[1].quiz.questions;
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            }
        }
        
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        }
        
        function submitQuiz() {
            const questions = window.moduleContent[1].quiz.questions;
            let correct = 0;
            
            questions.forEach(question => {
                if (quizAnswers[question.id] === question.correct) {
                    correct++;
                }
            });
            
            const score = Math.round((correct / questions.length) * 100);
            
            // Mark quiz completed
            window.progressTracker.markQuizCompleted(currentModuleId, score);
            
            // Show results
            const container = document.getElementById('question-container');
            container.innerHTML = `
                <div class="quiz-results">
                    <h2>Quiz Complete!</h2>
                    <p class="score">Your Score: ${score}%</p>
                    <p>You got ${correct} out of ${questions.length} questions correct.</p>
                    ${score >= 70 ? 
                        '<p class="success">Great job! You\'ve passed the assessment.</p>' : 
                        '<p class="warning">Keep studying and try again to improve your score.</p>'
                    }
                    <button class="quiz-btn" onclick="location.reload()">Review Module</button>
                </div>
            `;
            
            document.querySelector('.quiz-actions').style.display = 'none';
        }
        
        // Additional helper functions for activities
        function generateBiasGamePhotos() {
            const photos = [
                { id: 1, description: 'Young woman', prediction: 'Student' },
                { id: 2, description: 'Middle-aged man', prediction: 'CEO' },
                { id: 3, description: 'Young man', prediction: 'Engineer' },
                { id: 4, description: 'Older woman', prediction: 'Doctor' },
                { id: 5, description: 'Person in wheelchair', prediction: 'Software Developer' },
                { id: 6, description: 'Person with glasses', prediction: 'Scientist' }
            ];
            
            return photos.map(photo => `
                <div class="photo-card" onclick="showPrediction(${photo.id})">
                    <div class="photo-placeholder">
                        <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                            <circle cx="40" cy="30" r="15" stroke="currentColor" stroke-width="2"/>
                            <path d="M20 65C20 52 28 45 40 45C52 45 60 52 60 65" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </div>
                    <p class="photo-description">${photo.description}</p>
                    <div class="prediction hidden" id="prediction-${photo.id}">
                        AI Prediction: ${photo.prediction}
                    </div>
                </div>
            `).join('');
        }
        
        function showPrediction(photoId) {
            const prediction = document.getElementById(`prediction-${photoId}`);
            prediction.classList.remove('hidden');
        }
        
        function setupBiasGame() {
            // Add styles for bias game
            const style = document.createElement('style');
            style.textContent = `
                .photo-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                    gap: 1rem;
                    margin: 2rem 0;
                }
                
                .photo-card {
                    background: var(--light-bg);
                    padding: 1rem;
                    border-radius: 0.75rem;
                    text-align: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                }
                
                .photo-card:hover {
                    transform: translateY(-4px);
                    box-shadow: var(--shadow-md);
                }
                
                .photo-placeholder {
                    color: var(--text-secondary);
                    margin-bottom: 0.5rem;
                }
                
                .prediction {
                    margin-top: 0.5rem;
                    padding: 0.5rem;
                    background: var(--primary-color);
                    color: white;
                    border-radius: 0.5rem;
                    font-weight: 600;
                }
                
                .prediction.hidden {
                    display: none;
                }
                
                .bias-discussion {
                    margin-top: 2rem;
                    padding: 1.5rem;
                    background: var(--light-bg);
                    border-radius: 0.75rem;
                }
                
                .reflection-input {
                    width: 100%;
                    min-height: 100px;
                    padding: 0.75rem;
                    border: 2px solid var(--border-color);
                    border-radius: 0.5rem;
                    margin-top: 1rem;
                    font-family: inherit;
                }
                
                .activity-btn {
                    margin-top: 1rem;
                    padding: 0.75rem 1.5rem;
                    background: var(--gradient-primary);
                    color: white;
                    border: none;
                    border-radius: 0.5rem;
                    font-weight: 600;
                    cursor: pointer;
                }
                
                .visible-content {
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                }
                
                #activities.visible-content {
                    display: block !important;
                }
                
                .activity-card {
                    display: block !important;
                    visibility: visible !important;
                    background: var(--card-bg);
                    border-radius: 1rem;
                    padding: 2rem;
                    box-shadow: var(--shadow-md);
                    margin: 1rem 0;
                }
                
                .activity-header {
                    display: flex !important;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 1.5rem;
                }
                
                /* Module Hero Container Styles */
                .module-hero-container {
                    position: relative;
                    width: 100%;
                    height: 400px;
                    background: var(--light-bg);
                    border-radius: 1rem;
                    margin-bottom: 2rem;
                    overflow: hidden;
                    box-shadow: var(--shadow-lg);
                }
                
                .module-hero-image {
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                .image-placeholder {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    gap: 1rem;
                    color: var(--text-secondary);
                }
                
                .placeholder-text {
                    font-size: 1.125rem;
                    font-weight: 500;
                    color: var(--text-secondary);
                    margin: 0;
                }
                
                .module-title-overlay {
                    position: absolute;
                    top: 2rem;
                    left: 2rem;
                    right: 2rem;
                    z-index: 10;
                }
                
                .back-btn-overlay {
                    display: inline-flex;
                    align-items: center;
                    gap: 0.5rem;
                    padding: 0.5rem 1rem;
                    background: rgba(255, 255, 255, 0.9);
                    backdrop-filter: blur(8px);
                    border: none;
                    border-radius: 0.5rem;
                    color: var(--text-primary);
                    cursor: pointer;
                    transition: all 0.3s ease;
                    margin-bottom: 1rem;
                    font-weight: 500;
                }
                
                .back-btn-overlay:hover {
                    background: rgba(255, 255, 255, 1);
                    transform: translateY(-2px);
                    box-shadow: var(--shadow-md);
                }
                
                .module-meta-overlay {
                    display: flex;
                    gap: 1rem;
                    margin-bottom: 0.5rem;
                }
                
                .module-number {
                    font-size: 0.875rem;
                    font-weight: 600;
                    color: var(--primary-color);
                    text-transform: uppercase;
                }
                
                .module-duration {
                    font-size: 0.875rem;
                    color: var(--text-secondary);
                }
                
                .module-title-main {
                    font-size: 2.5rem;
                    font-weight: 700;
                    color: var(--text-primary);
                    margin: 0 0 0.5rem 0;
                    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                }
                
                .module-description-overlay {
                    font-size: 1.125rem;
                    color: var(--text-secondary);
                    margin: 0;
                    max-width: 600px;
                    line-height: 1.6;
                }
                
                .module-progress-overlay {
                    position: absolute;
                    bottom: 2rem;
                    left: 2rem;
                    right: 2rem;
                    z-index: 10;
                }
                
                .progress-info-overlay {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 0.5rem;
                }
                
                .progress-text-overlay {
                    font-size: 0.875rem;
                    font-weight: 600;
                    color: var(--text-primary);
                }
                
                .progress-bar-overlay {
                    width: 100%;
                    height: 8px;
                    background: rgba(255, 255, 255, 0.3);
                    border-radius: 4px;
                    overflow: hidden;
                    backdrop-filter: blur(8px);
                }
                
                .progress-fill-overlay {
                    height: 100%;
                    background: var(--gradient-primary);
                    transition: width 0.3s ease;
                    border-radius: 4px;
                }
                
                .start-unit-container {
                    position: absolute;
                    bottom: 2rem;
                    right: 2rem;
                    z-index: 10;
                }
                
                .start-unit-btn {
                    display: flex;
                    align-items: center;
                    gap: 0.75rem;
                    padding: 1rem 2rem;
                    background: var(--gradient-primary);
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    font-size: 1.125rem;
                    font-weight: 700;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    box-shadow: var(--shadow-lg);
                }
                
                .start-unit-btn:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 15px 25px -3px rgba(0, 0, 0, 0.15);
                }
                
                .start-unit-btn:active {
                    transform: translateY(-1px);
                }
                
                /* Sequential Content Styles */
                .module-flow.sequential-mode .content-section {
                    display: none;
                }
                
                .module-flow.sequential-mode .content-section.active {
                    display: block;
                    animation: fadeInUp 0.5s ease-out;
                }
                
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(20px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .sequential-nav {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1.5rem;
                    background: var(--card-bg);
                    border-radius: 0.75rem;
                    margin-top: 2rem;
                    box-shadow: var(--shadow-sm);
                }
                
                .sequential-progress {
                    flex: 1;
                    margin: 0 2rem;
                    text-align: center;
                }
                
                .sequential-progress-text {
                    font-size: 0.875rem;
                    color: var(--text-secondary);
                    margin-bottom: 0.5rem;
                }
                
                .sequential-progress-bar {
                    width: 100%;
                    height: 6px;
                    background: var(--border-color);
                    border-radius: 3px;
                    overflow: hidden;
                }
                
                .sequential-progress-fill {
                    height: 100%;
                    background: var(--gradient-primary);
                    transition: width 0.3s ease;
                }
                
                .nav-btn {
                    padding: 0.75rem 1.5rem;
                    border: 2px solid var(--border-color);
                    border-radius: 0.5rem;
                    background: var(--card-bg);
                    color: var(--text-primary);
                    cursor: pointer;
                    font-weight: 600;
                    transition: all 0.3s ease;
                }
                
                .nav-btn:hover {
                    border-color: var(--primary-color);
                    background: var(--primary-color);
                    color: white;
                }
                
                .nav-btn:disabled {
                    opacity: 0.5;
                    cursor: not-allowed;
                }
                
                .nav-btn.primary {
                    background: var(--gradient-primary);
                    color: white;
                    border-color: var(--primary-color);
                }
            `;
            document.head.appendChild(style);
        }
        
        function submitReflection(activityId, moduleId) {
            const reflection = document.querySelector('.reflection-input').value;
            if (reflection.trim().length > 10) {
                window.aiLiteracy.completeActivity(moduleId, activityId);
                alert('Reflection submitted successfully!');
            } else {
                alert('Please write a more detailed reflection.');
            }
        }
        
        function generateFishImages() {
            const items = [
                { id: 1, type: 'fish', name: 'Goldfish' },
                { id: 2, type: 'shark', name: 'Great White' },
                { id: 3, type: 'fish', name: 'Clownfish' },
                { id: 4, type: 'fish', name: 'Tuna' },
                { id: 5, type: 'shark', name: 'Hammerhead' },
                { id: 6, type: 'fish', name: 'Salmon' }
            ];
            
            return items.map(item => `
                <div class="classification-item" data-type="${item.type}" data-id="${item.id}">
                    <div class="item-image">
                        <svg width="60" height="40" viewBox="0 0 60 40" fill="none">
                            <ellipse cx="30" cy="20" rx="25" ry="15" stroke="currentColor" stroke-width="2"/>
                            <path d="M5 20L0 15V25L5 20Z" fill="currentColor"/>
                            ${item.type === 'shark' ? '<path d="M30 5L35 0L40 5" fill="currentColor"/>' : ''}
                        </svg>
                    </div>
                    <p>${item.name}</p>
                    <button class="classify-btn" onclick="classifyItem(${item.id}, '${item.type}')">
                        ${item.type === 'fish' ? 'Fish' : 'Shark'}
                    </button>
                </div>
            `).join('');
        }
        
        function trainClassifier(activityId) {
            const results = document.getElementById('classification-results');
            results.innerHTML = '<p>Training AI classifier... Done!</p><p>The AI has learned to distinguish between fish and sharks.</p>';
        }
        
        function testClassifier(activityId, moduleId) {
            const results = document.getElementById('classification-results');
            results.innerHTML = '<p>Testing classifier... 100% accuracy!</p><p>Great job training the AI!</p>';
            window.aiLiteracy.completeActivity(moduleId, activityId);
        }
        
        // Sequential Unit System
        let sequentialMode = false;
        let currentSequentialIndex = 0;
        let sequentialContent = [];
        
        function startUnit() {
            console.log('Starting sequential unit mode');
            sequentialMode = true;
            
            // Define the sequential content order
            sequentialContent = [
                { type: 'video', id: 'v1', title: 'What is AI?', element: '.content-section:nth-child(1)' },
                { type: 'video', id: 'v2', title: 'Can AI Lie?', element: '.content-section:nth-child(2)' },
                { type: 'activity', id: 'truth-hallucination', title: 'Truth or Hallucination?', element: '.content-section:nth-child(2)' },
                { type: 'video', id: 'v3', title: 'AI in Your Daily Life', element: '.content-section:nth-child(3)' },
                { type: 'video', id: 'v4', title: 'AI Ethics and Bias', element: '.content-section:nth-child(4)' },
                { type: 'activity', id: 'bias-experience', title: 'AI Bias Experience', element: '.content-section.sequential-only:nth-child(5)' },
                { type: 'assessment', id: 'quiz', title: 'Module Assessment', element: '#quiz' }
            ];
            
            currentSequentialIndex = 0;
            
            // Hide the hero container and show sequential mode
            const heroContainer = document.querySelector('.module-hero-container');
            const moduleFlow = document.querySelector('.module-flow');
            
            if (heroContainer) {
                heroContainer.style.display = 'none';
            }
            
            if (moduleFlow) {
                moduleFlow.classList.add('sequential-mode');
                
                // Add sequential navigation
                const sequentialNav = document.createElement('div');
                sequentialNav.className = 'sequential-nav';
                sequentialNav.innerHTML = `
                    <button class="nav-btn" id="prev-btn" onclick="previousSequentialItem()" disabled>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M8 16L0 8L8 0L9.4 1.4L3.8 7H16V9H3.8L9.4 14.6L8 16Z" fill="currentColor"/>
                        </svg>
                        Previous
                    </button>
                    <div class="sequential-progress">
                        <div class="sequential-progress-text">
                            <span id="current-item">1</span> of <span id="total-items">${sequentialContent.length}</span>
                        </div>
                        <div class="sequential-progress-bar">
                            <div class="sequential-progress-fill" id="sequential-progress-fill" style="width: ${(1/sequentialContent.length)*100}%"></div>
                        </div>
                    </div>
                    <button class="nav-btn primary" id="next-btn" onclick="nextSequentialItem()">
                        Next
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M8 0L16 8L8 16L6.6 14.6L12.2 9H0V7H12.2L6.6 1.4L8 0Z" fill="currentColor"/>
                        </svg>
                    </button>
                `;
                
                moduleFlow.appendChild(sequentialNav);
            }
            
            // Show the first item
            showSequentialItem(0);
        }
        
        function showSequentialItem(index) {
            if (index < 0 || index >= sequentialContent.length) return;
            
            const currentItem = sequentialContent[index];
            const moduleFlow = document.querySelector('.module-flow');
            
            // Hide all content sections
            const contentSections = moduleFlow.querySelectorAll('.content-section');
            contentSections.forEach(section => section.classList.remove('active'));
            
            // Hide quiz section
            const quizSection = document.getElementById('quiz');
            if (quizSection) quizSection.style.display = 'none';
            
            // Show current item
            if (currentItem.type === 'video') {
                const sectionIndex = parseInt(currentItem.element.match(/\d+/)[0]) - 1;
                if (contentSections[sectionIndex]) {
                    contentSections[sectionIndex].classList.add('active');
                }
            } else if (currentItem.type === 'activity') {
                // For activities, show the section and trigger the activity
                const sectionIndex = parseInt(currentItem.element.match(/\d+/)[0]) - 1;
                if (contentSections[sectionIndex]) {
                    contentSections[sectionIndex].classList.add('active');
                    // Auto-start the activity
                    setTimeout(() => {
                        startActivity(currentItem.id);
                    }, 500);
                }
            } else if (currentItem.type === 'assessment') {
                if (quizSection) {
                    quizSection.style.display = 'block';
                    startAssessment();
                }
            }
            
            // Update navigation
            updateSequentialNavigation();
        }
        
        function nextSequentialItem() {
            if (currentSequentialIndex < sequentialContent.length - 1) {
                currentSequentialIndex++;
                showSequentialItem(currentSequentialIndex);
            }
        }
        
        function previousSequentialItem() {
            if (currentSequentialIndex > 0) {
                currentSequentialIndex--;
                showSequentialItem(currentSequentialIndex);
            }
        }
        
        function updateSequentialNavigation() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const currentItemSpan = document.getElementById('current-item');
            const progressFill = document.getElementById('sequential-progress-fill');
            
            if (prevBtn) {
                prevBtn.disabled = currentSequentialIndex === 0;
            }
            
            if (nextBtn) {
                if (currentSequentialIndex === sequentialContent.length - 1) {
                    nextBtn.textContent = 'Complete Module';
                    nextBtn.onclick = completeModule;
                } else {
                    nextBtn.innerHTML = `
                        Next
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M8 0L16 8L8 16L6.6 14.6L12.2 9H0V7H12.2L6.6 1.4L8 0Z" fill="currentColor"/>
                        </svg>
                    `;
                    nextBtn.onclick = nextSequentialItem;
                }
            }
            
            if (currentItemSpan) {
                currentItemSpan.textContent = currentSequentialIndex + 1;
            }
            
            if (progressFill) {
                const progressPercent = ((currentSequentialIndex + 1) / sequentialContent.length) * 100;
                progressFill.style.width = `${progressPercent}%`;
            }
        }
        
        function completeModule() {
            // Show completion message and return to hero view
            alert('🎉 Congratulations! You have completed Module 1: AI Fundamentals!');
            
            // Reset to normal view
            sequentialMode = false;
            currentSequentialIndex = 0;
            
            const heroContainer = document.querySelector('.module-hero-container');
            const moduleFlow = document.querySelector('.module-flow');
            const sequentialNav = document.querySelector('.sequential-nav');
            
            if (heroContainer) {
                heroContainer.style.display = 'block';
            }
            
            if (moduleFlow) {
                moduleFlow.classList.remove('sequential-mode');
                const contentSections = moduleFlow.querySelectorAll('.content-section');
                contentSections.forEach(section => section.classList.remove('active'));
            }
            
            if (sequentialNav) {
                sequentialNav.remove();
            }
            
            // Update progress to 100%
            const progressFillOverlay = document.querySelector('.progress-fill-overlay');
            const progressTextOverlay = document.querySelector('.progress-text-overlay');
            
            if (progressFillOverlay) {
                progressFillOverlay.style.width = '100%';
            }
            
            if (progressTextOverlay) {
                progressTextOverlay.textContent = '100% Complete';
            }
        }
        
        function advanceToNextContent() {
            console.log('advanceToNextContent called');
            console.log('Current sequential index:', currentSequentialIndex);
            console.log('Sequential content length:', sequentialContent.length);
            
            // Close the current activity first
            closeTruthGame();
            
            // Advance to the next item in the sequence
            if (currentSequentialIndex < sequentialContent.length - 1) {
                currentSequentialIndex++;
                console.log('Advanced to index:', currentSequentialIndex);
                showSequentialItem(currentSequentialIndex);
            } else {
                console.log('Already at the last item');
                completeModule();
            }
        }

        // New functions for the flow-based layout
        function startActivity(activityId) {
            console.log('Starting activity:', activityId);
            
            if (activityId === 'truth-hallucination') {
                // Create the activity content directly in the main page
                const moduleFlow = document.querySelector('.module-flow');
                
                // Create a new container for the activity
                const activityContainer = document.createElement('div');
                activityContainer.id = 'truth-game-main';
                activityContainer.style.cssText = 'display: block; background: white; padding: 20px; margin: 20px; border-radius: 15px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);';
                
                activityContainer.innerHTML = `
                    <div style="background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); color: white; padding: 20px; margin-bottom: 20px; border-radius: 10px;">
                        <h2 style="margin: 0; display: inline-block;">Truth or Hallucination?</h2>
                        <button onclick="closeTruthGame()" style="float: right; background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">← Back to Module</button>
                        <div style="clear: both; margin-top: 10px;">
                            <p style="margin: 5px 0;">Can you tell the difference between real facts and AI hallucinations?</p>
                        </div>
                    </div>
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <p style="margin: 0; font-weight: 600;"><strong>Instructions:</strong> Click "Truth" if you think the statement is a real fact, or "Hallucination" if you think it's AI-generated misinformation.</p>
                    </div>
                    <div id="truth-statements-container">
                        ${generateTruthStatements()}
                    </div>
                    <div style="text-align: center; margin: 30px 0;">
                        <button onclick="checkAllTruthAnswers()" style="background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; margin-right: 10px;">Check My Answers</button>
                        <button onclick="resetAllTruthAnswers()" id="reset-truth-btn" style="background: #64748b; color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; display: none;">Try Again</button>
                    </div>
                    <div id="truth-feedback-area"></div>
                `;
                
                // Hide the module flow and insert the activity
                if (moduleFlow) {
                    moduleFlow.style.display = 'none';
                    moduleFlow.parentNode.insertBefore(activityContainer, moduleFlow.nextSibling);
                }
                
                console.log('Activity container created and inserted');
            } else if (activityId === 'bias-experience') {
                // Create the AI Bias Experience placeholder activity
                const moduleFlow = document.querySelector('.module-flow');
                
                // Create a new container for the activity
                const activityContainer = document.createElement('div');
                activityContainer.id = 'bias-experience-main';
                activityContainer.style.cssText = 'display: block; background: white; padding: 20px; margin: 20px; border-radius: 15px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);';
                
                activityContainer.innerHTML = `
                    <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 20px; margin-bottom: 20px; border-radius: 10px;">
                        <h2 style="margin: 0; display: inline-block;">AI Bias Experience</h2>
                        <button onclick="closeBiasExperience()" style="float: right; background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">← Back to Module</button>
                        <div style="clear: both; margin-top: 10px;">
                            <p style="margin: 5px 0;">Discover how AI systems can have built-in biases that affect real people.</p>
                        </div>
                    </div>
                    <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <p style="margin: 0; font-weight: 600;"><strong>Coming Soon:</strong> This interactive experience will help you understand how AI bias works and affects society.</p>
                    </div>
                    <div style="background: white; padding: 30px; border-radius: 10px; text-align: center; border: 2px dashed #e2e8f0;">
                        <div style="opacity: 0.6;">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none" style="margin-bottom: 20px;">
                                <rect x="10" y="10" width="60" height="45" rx="8" stroke="currentColor" stroke-width="2"/>
                                <circle cx="25" cy="25" r="6" fill="currentColor"/>
                                <rect x="45" y="20" width="20" height="4" fill="currentColor"/>
                                <rect x="45" y="28" width="15" height="3" fill="currentColor"/>
                                <path d="M10 45L25 35L35 40L70 20V55H10V45Z" fill="currentColor" opacity="0.3"/>
                            </svg>
                            <h3 style="color: #64748b; margin: 10px 0;">Activity Placeholder</h3>
                            <p style="color: #94a3b8; margin: 0;">This activity is currently under development</p>
                        </div>
                    </div>
                    <div id="bias-feedback-area">
                        ${generateBiasNavigationButtons()}
                    </div>
                `;
                
                // Hide the module flow and insert the activity
                if (moduleFlow) {
                    moduleFlow.style.display = 'none';
                    moduleFlow.parentNode.insertBefore(activityContainer, moduleFlow.nextSibling);
                }
                
                console.log('AI Bias Experience activity container created and inserted');
            }
        }
        
        function closeTruthGame() {
            const activityContainer = document.getElementById('truth-game-main');
            const moduleFlow = document.querySelector('.module-flow');
            
            if (activityContainer) {
                activityContainer.remove();
            }
            if (moduleFlow) {
                moduleFlow.style.display = 'block';
            }
        }
        
        function closeBiasExperience() {
            const activityContainer = document.getElementById('bias-experience-main');
            const moduleFlow = document.querySelector('.module-flow');
            
            if (activityContainer) {
                activityContainer.remove();
            }
            if (moduleFlow) {
                moduleFlow.style.display = 'block';
            }
        }
        
        function generateBiasNavigationButtons() {
            // Check if we're in sequential mode to show appropriate buttons
            const nextItemTitle = sequentialContent && sequentialContent[currentSequentialIndex + 1] 
                ? sequentialContent[currentSequentialIndex + 1].title 
                : 'Continue';
                
            return sequentialMode ? `
                <div style="margin-top: 30px; text-align: center; display: flex; gap: 20px; justify-content: center; align-items: center;">
                    <button onclick="advanceToNextContent()" style="
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white;
                        border: none;
                        padding: 15px 40px;
                        border-radius: 10px;
                        font-size: 18px;
                        font-weight: 700;
                        cursor: pointer;
                        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                        transform: scale(1);
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        ➡️ Next: ${nextItemTitle}
                    </button>
                    <button onclick="returnToBiasModule()" style="
                        background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
                        color: white;
                        border: none;
                        padding: 15px 40px;
                        border-radius: 10px;
                        font-size: 18px;
                        font-weight: 700;
                        cursor: pointer;
                        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                        transform: scale(1);
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        🎉 Return to Module
                    </button>
                </div>
            ` : `
                <div style="margin-top: 30px; text-align: center;">
                    <button onclick="returnToBiasModule()" style="
                        background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
                        color: white;
                        border: none;
                        padding: 15px 40px;
                        border-radius: 10px;
                        font-size: 18px;
                        font-weight: 700;
                        cursor: pointer;
                        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                        transform: scale(1);
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        🎉 Return to Module
                    </button>
                </div>
            `;
        }
        
        function returnToBiasModule() {
            closeBiasExperience();
            
            // Update progress tracking (same as returnToModule)
            setTimeout(() => {
                const moduleProgress = window.progressTracker?.calculateModuleProgress?.(currentModuleId) || 0;
                
                // Update navbar progress bar (total progress)
                let totalProgress = 0;
                for (let i = 1; i <= 4; i++) {
                    totalProgress += (window.progressTracker?.calculateModuleProgress?.(i) || 0);
                }
                totalProgress = Math.round(totalProgress / 4);
                
                const navProgressBar = document.querySelector('.nav-container .progress-fill');
                if (navProgressBar) {
                    navProgressBar.style.width = `${totalProgress}%`;
                }
                
                // If not in sequential mode, also update the module progress bar
                if (!sequentialMode) {
                    const moduleProgressBar = document.querySelector('.progress-fill');
                    if (moduleProgressBar) {
                        moduleProgressBar.style.width = `${moduleProgress}%`;
                    }
                    
                    const progressText = document.querySelector('.progress-text');
                    if (progressText) {
                        progressText.textContent = `${moduleProgress}% Complete`;
                    }
                }
            }, 100);
        }
        
        function returnToModule() {
            closeTruthGame();
            
            // Update progress tracking
            setTimeout(() => {
                const moduleProgress = window.progressTracker?.calculateModuleProgress?.(currentModuleId) || 0;
                
                // Update navbar progress bar (total progress)
                let totalProgress = 0;
                for (let i = 1; i <= 4; i++) {
                    totalProgress += (window.progressTracker?.calculateModuleProgress?.(i) || 0);
                }
                totalProgress = Math.round(totalProgress / 4);
                
                const navProgressBar = document.querySelector('.nav-container .progress-fill');
                if (navProgressBar) {
                    navProgressBar.style.width = `${totalProgress}%`;
                }
                
                // If not in sequential mode, also update the module progress bar
                if (!sequentialMode) {
                    const moduleProgressBar = document.querySelector('.progress-fill');
                    if (moduleProgressBar) {
                        moduleProgressBar.style.width = `${moduleProgress}%`;
                    }
                    
                    const progressText = document.querySelector('.progress-text');
                    if (progressText) {
                        progressText.textContent = `${moduleProgress}% Complete`;
                    }
                }
            }, 100);
        }
        
        function startAssessment() {
            const moduleFlow = document.querySelector('.module-flow');
            const quizContainer = document.getElementById('quiz');
            
            // Hide the main flow and show quiz
            moduleFlow.style.display = 'none';
            quizContainer.style.display = 'block';
            
            loadQuizQuestions();
        }
        
        function backToModule() {
            const moduleFlow = document.querySelector('.module-flow');
            const activitiesContainer = document.getElementById('activities');
            const quizContainer = document.getElementById('quiz');
            
            // Show the main flow and hide others
            moduleFlow.style.display = 'block';
            activitiesContainer.style.display = 'none';
            quizContainer.style.display = 'none';
        }
        
        function loadClassificationGame() {
            const container = document.querySelector('#activities .activities-container');
            container.innerHTML = `
                <div class="activity-card">
                    <div class="activity-header">
                        <h3 class="activity-title">Truth or Hallucination?</h3>
                        <button class="back-to-module-btn" onclick="backToModule()">Back to Module</button>
                    </div>
                    <p>Can you tell the difference between real facts and AI hallucinations? Test your skills!</p>
                    <div class="truth-game">
                        <div class="game-instructions">
                            <p><strong>Instructions:</strong> Read each statement and decide if it's a real fact or an AI hallucination (made-up information).</p>
                        </div>
                        <div class="statements-container" id="statements-container">
                            ${generateTruthStatements()}
                        </div>
                        <div class="game-controls">
                            <button class="activity-btn" onclick="checkAllAnswers()">Check My Answers</button>
                            <button class="activity-btn" onclick="resetGame()" style="display: none;" id="reset-btn">Try Again</button>
                        </div>
                        <div id="game-results"></div>
                    </div>
                </div>
            `;
        }
        
        function loadTruthHallucinationGame() {
            console.log('loadTruthHallucinationGame called');
            const container = document.querySelector('#activities .activities-container');
            console.log('Container found:', container);
            
            if (!container) {
                console.error('Container not found!');
                return;
            }
            
            const htmlContent = `
                <div class="activity-card" style="display: block !important; background: red; padding: 20px; margin: 20px;">
                    <div class="activity-header" style="display: block !important; background: blue; color: white; padding: 10px;">
                        <h3 class="activity-title">Truth or Hallucination?</h3>
                        <button class="back-to-module-btn" onclick="backToModule()">Back to Module</button>
                    </div>
                    <p style="display: block !important; background: green; color: white; padding: 10px;">Read each statement and decide if it's a real fact or an AI hallucination (made-up information).</p>
                    <div class="truth-game-container" style="display: block !important; background: yellow; padding: 10px;">
                        <div class="game-instructions">
                            <p><strong>Instructions:</strong> Click "Truth" if you think the statement is a real fact, or "Hallucination" if you think it's AI-generated misinformation.</p>
                        </div>
                        <div class="statements-container" id="statements-container">
                            ${generateTruthStatements()}
                        </div>
                        <div class="game-controls">
                            <button class="activity-btn" onclick="checkTruthAnswers('truth-hallucination', ${currentModuleId})">Check My Answers</button>
                            <button class="activity-btn" onclick="resetTruthGame('truth-hallucination')" style="display: none;" id="reset-btn">Try Again</button>
                        </div>
                        <div class="feedback-area" id="feedback-truth-hallucination"></div>
                    </div>
                </div>
            `;
            
            console.log('Setting HTML content:', htmlContent);
            container.innerHTML = htmlContent;
            console.log('Container after setting HTML:', container);
            console.log('HTML set, calling setupTruthGame');
            setupTruthGame();
            console.log('setupTruthGame completed');
        }
        
        function loadBiasExperience() {
            const container = document.querySelector('#activities .activities-container');
            setupBiasGame();
            container.innerHTML = `
                <div class="activity-card">
                    <div class="activity-header">
                        <h3 class="activity-title">AI Bias Experience</h3>
                        <button class="back-to-module-btn" onclick="backToModule()">Back to Module</button>
                    </div>
                    <p>Click on each photo to see what an AI might predict about these people. Think about whether these predictions seem fair.</p>
                    <div class="photo-grid">
                        ${generateBiasGamePhotos()}
                    </div>
                    <div class="bias-discussion">
                        <h4>Reflection</h4>
                        <p>What patterns did you notice in the AI's predictions? How might this bias affect real people?</p>
                        <textarea class="reflection-input" placeholder="Share your thoughts about AI bias..."></textarea>
                        <button class="activity-btn" onclick="submitReflection('bias-experience', ${currentModuleId})">Submit Reflection</button>
                    </div>
                </div>
            `;
        }

        // Truth or Hallucination Game Functions
        function generateTruthStatements() {
            const statements = [
                {
                    id: 1,
                    text: "The Great Wall of China is visible from space with the naked eye.",
                    isTrue: false,
                    explanation: "This is a common myth! The Great Wall is not visible from space without aid."
                },
                {
                    id: 2,
                    text: "Octopuses have three hearts and blue blood.",
                    isTrue: true,
                    explanation: "This is true! Octopuses have 3 hearts and blue blood due to copper-based hemocyanin."
                },
                {
                    id: 3,
                    text: "Shakespeare invented over 1,700 words that we still use today, including 'emoji' and 'selfie'.",
                    isTrue: false,
                    explanation: "Shakespeare did invent many words, but 'emoji' and 'selfie' are modern inventions from the digital age."
                },
                {
                    id: 4,
                    text: "Honey never spoils and can last thousands of years.",
                    isTrue: true,
                    explanation: "True! Honey's low moisture and acidic pH make it naturally antimicrobial."
                },
                {
                    id: 5,
                    text: "A group of flamingos is called a 'flamboyance'.",
                    isTrue: true,
                    explanation: "This is correct! A group of flamingos is indeed called a flamboyance."
                },
                {
                    id: 6,
                    text: "Bananas grow on trees and are technically a type of wood fruit.",
                    isTrue: false,
                    explanation: "Bananas grow on large herbaceous flowering plants, not trees, and are berries, not wood fruits."
                },
                {
                    id: 7,
                    text: "The human brain uses approximately 20% of the body's total energy.",
                    isTrue: true,
                    explanation: "True! Despite being only 2% of body weight, the brain uses about 20% of our energy."
                },
                {
                    id: 8,
                    text: "Goldfish have a 3-second memory span.",
                    isTrue: false,
                    explanation: "This is a myth! Goldfish can remember things for months, not just 3 seconds."
                }
            ];
            
            return statements.map(statement => `
                <div style="background: white; border: 2px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-bottom: 15px; transition: all 0.3s ease;" 
                     class="truth-statement-card" data-statement-id="${statement.id}" data-is-true="${statement.isTrue}">
                    <div style="font-size: 18px; line-height: 1.6; margin-bottom: 15px; color: #1e293b; font-weight: 500;">
                        ${statement.text}
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 15px;">
                        <button onclick="selectTruthAnswer(${statement.id}, true)" 
                                style="padding: 10px 25px; border: 2px solid #10b981; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; background: white; color: #10b981;"
                                class="truth-choice-btn">Truth</button>
                        <button onclick="selectTruthAnswer(${statement.id}, false)" 
                                style="padding: 10px 25px; border: 2px solid #ef4444; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; background: white; color: #ef4444;"
                                class="hallucination-choice-btn">Hallucination</button>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px; font-style: italic; color: #64748b; border-left: 4px solid #6366f1; display: none;" 
                         class="truth-explanation" id="explanation-${statement.id}">
                        ${statement.explanation}
                    </div>
                </div>
            `).join('');
        }
        
        function selectTruthAnswer(statementId, userAnswer) {
            window.truthGameAnswers = window.truthGameAnswers || {};
            window.truthGameAnswers[statementId] = userAnswer;
            
            // Find the statement card
            const card = document.querySelector(`[data-statement-id="${statementId}"]`);
            if (!card) {
                console.error('Card not found for statement:', statementId);
                return;
            }
            
            const truthBtn = card.querySelector('.truth-choice-btn');
            const hallucinationBtn = card.querySelector('.hallucination-choice-btn');
            
            if (!truthBtn || !hallucinationBtn) {
                console.error('Buttons not found. TruthBtn:', truthBtn, 'HallucinationBtn:', hallucinationBtn);
                return;
            }
            
            // Reset button styles
            truthBtn.style.background = 'white';
            truthBtn.style.color = '#10b981';
            hallucinationBtn.style.background = 'white';
            hallucinationBtn.style.color = '#ef4444';
            
            // Highlight selected button with enhanced visual feedback
            if (userAnswer) {
                truthBtn.style.background = '#10b981';
                truthBtn.style.color = 'white';
                truthBtn.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';
                truthBtn.style.transform = 'translateY(-2px)';
                truthBtn.style.borderWidth = '3px';
                // Make unselected button colorless
                hallucinationBtn.style.background = '#f8fafc';
                hallucinationBtn.style.color = '#64748b';
                hallucinationBtn.style.borderColor = '#e2e8f0';
                hallucinationBtn.style.transform = 'none';
                hallucinationBtn.style.borderWidth = '2px';
            } else {
                hallucinationBtn.style.background = '#ef4444';
                hallucinationBtn.style.color = 'white';
                hallucinationBtn.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';
                hallucinationBtn.style.transform = 'translateY(-2px)';
                hallucinationBtn.style.borderWidth = '3px';
                // Make unselected button colorless
                truthBtn.style.background = '#f8fafc';
                truthBtn.style.color = '#64748b';
                truthBtn.style.borderColor = '#e2e8f0';
                truthBtn.style.transform = 'none';
                truthBtn.style.borderWidth = '2px';
            }
        }
        
        function checkAllTruthAnswers() {
            const statements = document.querySelectorAll('.truth-statement-card');
            let correct = 0;
            let total = statements.length;
            
            statements.forEach(statement => {
                const statementId = parseInt(statement.dataset.statementId);
                const isTrue = statement.dataset.isTrue === 'true';
                const userAnswer = window.truthGameAnswers[statementId];
                const explanation = statement.querySelector('.truth-explanation');
                
                // Show explanation
                explanation.style.display = 'block';
                
                // Check if correct and update card styling
                if (userAnswer === isTrue) {
                    correct++;
                    statement.style.borderColor = '#10b981';
                    statement.style.background = 'rgba(16, 185, 129, 0.05)';
                } else {
                    statement.style.borderColor = '#ef4444';
                    statement.style.background = 'rgba(239, 68, 68, 0.05)';
                }
            });
            
            const percentage = Math.round((correct / total) * 100);
            const feedbackArea = document.getElementById('truth-feedback-area');
            
            feedbackArea.innerHTML = `
                <div style="background: ${percentage >= 70 ? 'rgba(16, 185, 129, 0.1)' : 'rgba(245, 158, 11, 0.1)'}; 
                            border: 2px solid ${percentage >= 70 ? '#10b981' : '#f59e0b'}; 
                            border-radius: 10px; padding: 20px; text-align: center; margin-top: 20px;">
                    <h3 style="margin: 0 0 10px 0; color: ${percentage >= 70 ? '#10b981' : '#f59e0b'};">
                        Results: ${correct}/${total} correct (${percentage}%)
                    </h3>
                    <p style="margin: 10px 0; font-size: 16px;">
                        ${percentage >= 70 ? 
                            'Great job! You\'re getting good at spotting AI hallucinations!' : 
                            'Keep practicing! Understanding AI accuracy is an important skill.'
                        }
                    </p>
                    <p style="margin: 10px 0; font-weight: 600;">
                        <strong>Remember:</strong> AI can sometimes generate false information that sounds convincing. Always verify important facts!
                    </p>
                </div>
            `;
            
            // Show reset button
            document.getElementById('reset-truth-btn').style.display = 'inline-block';
            
            if (percentage >= 70) {
                // Mark activity as completed
                console.log('Marking activity as completed');
                console.log('Current module ID:', currentModuleId);
                console.log('Activity ID: truth-hallucination');
                
                if (window.progressTracker && window.progressTracker.markActivityCompleted) {
                    // Check progress before marking complete
                    const progressBefore = JSON.parse(localStorage.getItem('aiLiteracyDetailedProgress') || '{}');
                    console.log('Progress before marking complete:', progressBefore);
                    
                    window.progressTracker.markActivityCompleted(currentModuleId, 'truth-hallucination');
                    console.log('Activity marked as completed via progressTracker');
                    
                    // Check progress after marking complete
                    const progressAfter = JSON.parse(localStorage.getItem('aiLiteracyDetailedProgress') || '{}');
                    console.log('Progress after marking complete:', progressAfter);
                    console.log('Module 1 activities after:', progressAfter.modules?.[1]?.activities);
                } else {
                    console.error('progressTracker not available');
                }
                
                if (window.aiLiteracy && window.aiLiteracy.completeActivity) {
                    window.aiLiteracy.completeActivity(currentModuleId, 'truth-hallucination');
                    console.log('Activity marked as completed via aiLiteracy');
                }
                
                // Add navigation buttons
                const nextItemTitle = sequentialContent && sequentialContent[currentSequentialIndex + 1] 
                    ? sequentialContent[currentSequentialIndex + 1].title 
                    : 'Continue';
                
                console.log('Creating next button - sequentialMode:', sequentialMode);
                console.log('Current index:', currentSequentialIndex);
                console.log('Next item title:', nextItemTitle);
                console.log('Sequential content:', sequentialContent);
                
                const buttonsHtml = sequentialMode ? `
                    <div style="margin-top: 30px; text-align: center; display: flex; gap: 20px; justify-content: center; align-items: center;">
                        <button onclick="advanceToNextContent()" style="
                            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                            color: white;
                            border: none;
                            padding: 15px 40px;
                            border-radius: 10px;
                            font-size: 18px;
                            font-weight: 700;
                            cursor: pointer;
                            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                            transform: scale(1);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            ➡️ Next: ${nextItemTitle}
                        </button>
                        <button onclick="returnToModule()" style="
                            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
                            color: white;
                            border: none;
                            padding: 15px 40px;
                            border-radius: 10px;
                            font-size: 18px;
                            font-weight: 700;
                            cursor: pointer;
                            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                            transform: scale(1);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            🎉 Return to Module
                        </button>
                    </div>
                ` : `
                    <div style="margin-top: 30px; text-align: center;">
                        <button onclick="returnToModule()" style="
                            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
                            color: white;
                            border: none;
                            padding: 15px 40px;
                            border-radius: 10px;
                            font-size: 18px;
                            font-weight: 700;
                            cursor: pointer;
                            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                            transform: scale(1);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            🎉 Return to Module
                        </button>
                    </div>
                `;
                
                feedbackArea.innerHTML += buttonsHtml;
            }
        }
        
        function resetAllTruthAnswers() {
            window.truthGameAnswers = {};
            
            // Reset all statement cards
            const statements = document.querySelectorAll('.truth-statement-card');
            statements.forEach(statement => {
                statement.style.borderColor = '#e2e8f0';
                statement.style.background = 'white';
                
                // Reset buttons
                const truthBtn = statement.querySelector('.truth-choice-btn');
                const hallucinationBtn = statement.querySelector('.hallucination-choice-btn');
                truthBtn.style.background = 'white';
                truthBtn.style.color = '#10b981';
                truthBtn.style.boxShadow = 'none';
                hallucinationBtn.style.background = 'white';
                hallucinationBtn.style.color = '#ef4444';
                hallucinationBtn.style.boxShadow = 'none';
                
                // Hide explanation
                statement.querySelector('.truth-explanation').style.display = 'none';
            });
            
            // Clear feedback
            document.getElementById('truth-feedback-area').innerHTML = '';
            
            // Hide reset button
            document.getElementById('reset-truth-btn').style.display = 'none';
        }

        function setupTruthGame() {
            window.truthGameAnswers = {};
        }


        function checkTruthAnswers(activityId, moduleId) {
            const statements = document.querySelectorAll('.statement-card');
            let correct = 0;
            let total = statements.length;
            
            statements.forEach(statement => {
                const statementId = parseInt(statement.dataset.statementId);
                const isTrue = statement.dataset.isTrue === 'true';
                const userAnswer = window.truthGameAnswers[statementId];
                const explanation = statement.querySelector('.statement-explanation');
                
                explanation.classList.remove('hidden');
                
                if (userAnswer === isTrue) {
                    correct++;
                    statement.classList.add('correct');
                } else {
                    statement.classList.add('incorrect');
                }
            });
            
            const feedback = document.getElementById(`feedback-${activityId}`);
            const percentage = Math.round((correct / total) * 100);
            
            feedback.innerHTML = `
                <div class="feedback ${percentage >= 70 ? 'success' : 'partial'}">
                    <h4>Results: ${correct}/${total} correct (${percentage}%)</h4>
                    ${percentage >= 70 ? 
                        '<p>Great job! You\'re getting good at spotting AI hallucinations!</p>' : 
                        '<p>Keep practicing! Understanding AI accuracy is an important skill.</p>'
                    }
                    <p><strong>Remember:</strong> AI can sometimes generate false information that sounds convincing. Always verify important facts!</p>
                </div>
            `;
            
            document.getElementById('reset-btn').style.display = 'inline-block';
            
            if (percentage >= 70) {
                window.aiLiteracy.completeActivity(moduleId, activityId);
            }
        }

        function resetTruthGame(activityId) {
            window.truthGameAnswers = {};
            
            const statements = document.querySelectorAll('.statement-card');
            statements.forEach(statement => {
                statement.classList.remove('correct', 'incorrect');
                statement.querySelectorAll('.truth-btn, .hallucination-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                statement.querySelector('.statement-explanation').classList.add('hidden');
            });
            
            const feedback = document.getElementById(`feedback-${activityId}`);
            feedback.innerHTML = '';
            
            document.getElementById('reset-btn').style.display = 'none';
        }

        // Make functions globally available
        window.generateBiasGamePhotos = generateBiasGamePhotos;
        window.showPrediction = showPrediction;
        window.setupBiasGame = setupBiasGame;
        window.submitReflection = submitReflection;
        window.generateFishImages = generateFishImages;
        window.trainClassifier = trainClassifier;
        window.testClassifier = testClassifier;
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.submitQuiz = submitQuiz;
        window.selectAnswer = selectAnswer;
        window.startActivity = startActivity;
        window.startAssessment = startAssessment;
        window.backToModule = backToModule;
        window.generateTruthStatements = generateTruthStatements;
        window.setupTruthGame = setupTruthGame;
        window.selectTruthAnswer = selectTruthAnswer;
        window.checkTruthAnswers = checkTruthAnswers;
        window.resetTruthGame = resetTruthGame;
        window.returnToModule = returnToModule;
        window.startUnit = startUnit;
        window.nextSequentialItem = nextSequentialItem;
        window.previousSequentialItem = previousSequentialItem;
        window.completeModule = completeModule;
        window.advanceToNextContent = advanceToNextContent;
        window.closeBiasExperience = closeBiasExperience;
        window.returnToBiasModule = returnToBiasModule;
        
        // Navigate to activity page
        function openActivityWindow(activityId) {
            if (activityId === 'truth-hallucination') {
                window.location.href = 'truth-hallucination.html';
            } else if (activityId === 'bias-experience') {
                window.location.href = 'bias-experience.html';
            } else if (activityId === 'assessment') {
                window.location.href = 'assessment.html';
            }
        }
        
        window.openActivityWindow = openActivityWindow;
    </script>
</body>
</html>