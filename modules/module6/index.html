<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 6: Digital Citizenship and Future Technologies - AI Literacy Learning</title>
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/modules.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>Module 6: Digital Citizenship and Future Technologies</h1>
            </div>
            <div class="nav-user">
                <button class="back-btn" onclick="moduleManager.goBack()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M12 5L7 10L12 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    Back to Dashboard
                </button>
            </div>
        </div>
    </nav>

    <div class="module-page">
        <div class="module-content">
            <!-- Enhanced Module Header with Image -->
            <div class="module-hero-container">
                <div class="module-hero-image">
                    <!-- Placeholder for module image -->
                    <div class="image-placeholder">
                        <svg width="100" height="100" viewBox="0 0 100 100" fill="none" class="placeholder-icon">
                            <rect x="10" y="10" width="80" height="60" rx="8" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            <circle cx="30" cy="30" r="8" fill="currentColor" opacity="0.3"/>
                            <path d="M10 60L35 40L50 50L90 20V70H10V60Z" fill="currentColor" opacity="0.3"/>
                        </svg>
                        <p class="placeholder-text">Module Image</p>
                    </div>
                </div>
                
                <!-- Overlaid Title (Top Left) -->
                <div class="module-title-overlay">
                    <button class="back-btn-overlay" onclick="window.location.href='index.html'">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M8 16L0 8L8 0L9.4 1.4L3.8 7H16V9H3.8L9.4 14.6L8 16Z" fill="currentColor"/>
                        </svg>
                        Back
                    </button>
                    <div class="module-meta-overlay">
                        <span class="module-number">Module 06</span>
                        <span class="module-duration">~2 hours</span>
                    </div>
                    <h1 class="module-title-main">Digital Citizenship and Future Technologies</h1>
                    <p class="module-description-overlay">Become a responsible digital citizen, explore emerging technologies, and help shape a better digital future.</p>
                </div>
                
                <!-- Progress Bar (Bottom) -->
                <div class="module-progress-overlay">
                    <div class="progress-info-overlay">
                        <span class="progress-text-overlay">0% Complete</span>
                    </div>
                    <div class="progress-bar-overlay">
                        <div class="progress-fill-overlay module-progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Start Unit Button -->
                <div class="start-unit-container">
                    <button class="start-unit-btn" onclick="startUnit()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="start-icon">
                            <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                        </svg>
                        Start Unit
                    </button>
                </div>
            </div>

            <div class="module-flow">
                <!-- Video 1: How AI Learns and Solves Problems -->
                <div class="content-section">
                    <div class="video-section">
                        <div class="video-player" onclick="playMainVideo()">
                            <video id="main-video" width="100%" height="300" controls style="display: none;">
                                <source src="../../../LineStyle Explainer Video Toolkit_1080p.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <div class="play-btn" id="main-play-btn">
                                <svg width="35" height="35" viewBox="0 0 30 30" fill="none">
                                    <path d="M10 7L22 15L10 23V7Z" fill="currentColor"/>
                                </svg>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">How AI Learns and Solves Problems</h3>
                            <p class="video-description">Discover how AI uses data to learn patterns and make decisions, and understand the importance of ethical data collection.</p>
                            <span class="video-duration">Duration: 15:30</span>
                        </div>
                    </div>
                    
                    <!-- Vocabulary Bank Activity Button -->
                    <div class="activity-button-section">
                        <button class="activity-button" onclick="openActivityWindow('vocab-bank')">
                            <div class="activity-thumbnail">
                                <svg width="40" height="40" viewBox="0 0 60 60" fill="none">
                                    <rect x="15" y="10" width="30" height="40" rx="4" stroke="currentColor" stroke-width="2"/>
                                    <line x1="20" y1="20" x2="40" y2="20" stroke="currentColor" stroke-width="2"/>
                                    <line x1="20" y1="25" x2="35" y2="25" stroke="currentColor" stroke-width="2"/>
                                    <line x1="20" y1="30" x2="40" y2="30" stroke="currentColor" stroke-width="2"/>
                                    <line x1="20" y1="35" x2="32" y2="35" stroke="currentColor" stroke-width="2"/>
                                    <line x1="20" y1="40" x2="38" y2="40" stroke="currentColor" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <h4>Vocabulary Bank</h4>
                                <p>Learn key AI and digital citizenship terms</p>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Quiz Activity Button -->
                <div class="content-section">
                    <div class="activity-button-section">
                        <button class="activity-button" onclick="openActivityWindow('quiz')">
                            <div class="activity-thumbnail">
                                <svg width="40" height="40" viewBox="0 0 60 60" fill="none">
                                    <circle cx="30" cy="20" r="8" stroke="currentColor" stroke-width="2"/>
                                    <path d="M30 32V45" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                    <circle cx="30" cy="50" r="2" fill="currentColor"/>
                                    <path d="M25 15Q30 10 35 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <h4>Knowledge Check Quiz</h4>
                                <p>Test your understanding of AI learning concepts</p>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Video 2: How AI Learns and Helps Us -->
                <div class="content-section">
                    <div class="video-section">
                        <div class="video-player" onclick="playSecondVideo()">
                            <video id="second-video" width="100%" height="300" controls style="display: none;">
                                <source src="../../../3D Explainer Video Toolkit_1080p.mp4" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                            <div class="play-btn" id="second-play-btn">
                                <svg width="35" height="35" viewBox="0 0 30 30" fill="none">
                                    <path d="M10 7L22 15L10 23V7Z" fill="currentColor"/>
                                </svg>
                            </div>
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">How AI Learns and Helps Us</h3>
                            <p class="video-description">Explore the ways AI assists us in daily life and how it continues to learn and improve.</p>
                            <span class="video-duration">Duration: 12:45</span>
                        </div>
                    </div>
                </div>

                <!-- Data Detective Game -->
                <div class="content-section">
                    <div class="activity-button-section">
                        <button class="activity-button" onclick="openActivityWindow('data-detective')">
                            <div class="activity-thumbnail">
                                <svg width="40" height="40" viewBox="0 0 60 60" fill="none">
                                    <circle cx="30" cy="25" r="12" stroke="currentColor" stroke-width="2"/>
                                    <path d="M38 35L45 42" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                    <circle cx="30" cy="25" r="6" fill="currentColor" opacity="0.3"/>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <h4>Data Detective</h4>
                                <p>Sort, label, and analyze data to understand how AI learns from information</p>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Exit Poll Activity Button -->
                <div class="content-section">
                    <div class="activity-button-section">
                        <button class="activity-button" onclick="openActivityWindow('exit-poll')">
                            <div class="activity-thumbnail">
                                <svg width="40" height="40" viewBox="0 0 60 60" fill="none">
                                    <rect x="10" y="15" width="40" height="30" rx="4" stroke="currentColor" stroke-width="2"/>
                                    <line x1="15" y1="25" x2="35" y2="25" stroke="currentColor" stroke-width="2"/>
                                    <line x1="15" y1="30" x2="30" y2="30" stroke="currentColor" stroke-width="2"/>
                                    <line x1="15" y1="35" x2="35" y2="35" stroke="currentColor" stroke-width="2"/>
                                    <circle cx="42" cy="28" r="3" fill="currentColor"/>
                                    <circle cx="42" cy="35" r="3" fill="currentColor"/>
                                </svg>
                            </div>
                            <div class="activity-content">
                                <h4>Exit Poll</h4>
                                <p>Share feedback about your AI learning journey</p>
                            </div>
                        </button>
                    </div>
                </div>



                <!-- Hidden containers for activities and quiz -->
                <div class="hidden-content" id="activities" style="display: none;">
                    <div class="activities-container">
                        <!-- Activities will be loaded by JavaScript -->
                    </div>
                </div>

                <div class="hidden-content" id="quiz" style="display: none;">
                    <div class="quiz-container">
                        <div class="quiz-progress">
                            <span>Question <span id="current-question">1</span> of <span id="total-questions">4</span></span>
                            <div class="quiz-progress-bar">
                                <div class="quiz-progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="question-container" id="question-container">
                            <!-- Quiz questions will be loaded by JavaScript -->
                        </div>
                        <div class="quiz-actions">
                            <button class="quiz-btn" id="prev-btn" onclick="previousQuestion()" disabled>Previous</button>
                            <button class="quiz-btn" id="next-btn" onclick="nextQuestion()">Next</button>
                            <button class="quiz-btn" id="submit-btn" onclick="submitQuiz()" style="display: none;">Submit Quiz</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../../js/modules.js"></script>
    <script src="../../js/activities.js"></script>
    <script src="../../js/progress.js"></script>
    <script>
        const currentModuleId = 6;
        let currentQuestionIndex = 0;
        let quizAnswers = {};
        
        // Activity completion tracking for Module 6
        let moduleActivities = {
            'vocab-bank': false,
            'data-detective': false, 
            'exit-poll': false,
            'quiz': false
        };
        
        // Load completion status from localStorage (TEMPORARILY DISABLED)
        function loadProgressFromStorage() {
            const savedProgress = localStorage.getItem('module6-progress');
            console.log('Loading progress from storage:', savedProgress);
            if (savedProgress) {
                try {
                    const parsed = JSON.parse(savedProgress);
                    console.log('Parsed progress:', parsed);
                    moduleActivities = { ...moduleActivities, ...parsed };
                    console.log('Updated moduleActivities:', moduleActivities);
                } catch (e) {
                    console.log('Error loading progress:', e);
                }
            }
            console.log('Starting with moduleActivities:', moduleActivities);
            updateProgressBar();
        }
        
        // Save completion status to localStorage (TEMPORARILY DISABLED)
        function saveProgressToStorage() {
            console.log('Saving progress to localStorage:', moduleActivities);
            localStorage.setItem('module6-progress', JSON.stringify(moduleActivities));
        }
        
        // Update the progress bar based on completed activities
        function updateProgressBar() {
            const totalActivities = Object.keys(moduleActivities).length;
            const completedActivities = Object.values(moduleActivities).filter(completed => completed).length;
            const progressPercentage = (completedActivities / totalActivities) * 100;
            
            console.log(`Progress: ${completedActivities}/${totalActivities} activities completed (${progressPercentage.toFixed(1)}%)`);
            
            // Update the main module progress bar (not slideshow progress)
            const progressFill = document.querySelector('.module-hero-container .progress-fill-overlay');
            if (progressFill) {
                progressFill.style.width = `${progressPercentage}%`;
            }
            
            // Also update any other module progress bars
            const moduleProgressFill = document.querySelector('.module-progress-fill:not(#slideshow-progress-fill)');
            if (moduleProgressFill) {
                moduleProgressFill.style.width = `${progressPercentage}%`;
            }
            
            // Update progress text
            const progressText = document.querySelector('.progress-text-overlay');
            if (progressText) {
                progressText.textContent = `${progressPercentage.toFixed(0)}% Complete`;
            }
            
            return { completed: completedActivities, total: totalActivities, percentage: progressPercentage };
        }
        
        // Mark an activity as completed
        function markActivityCompleted(activityId) {
            console.log(`🎯 MARKING ACTIVITY COMPLETED: ${activityId}`);
            console.trace('Call stack for marking activity completed:'); // This will show where the call came from
            
            moduleActivities[activityId] = true;
            saveProgressToStorage();
            updateProgressBar();
            
            // Update next button state in case we're in slideshow mode
            if (window.slideshowMode) {
                updateNextButtonState();
            }
        }
        
        // Reset progress (for testing/debugging)
        function resetModuleProgress() {
            console.log('Resetting Module 6 progress');
            moduleActivities = {
                'vocab-bank': false,
                'data-detective': false, 
                'exit-poll': false,
                'quiz': false
            };
            saveProgressToStorage();
            updateProgressBar();
        }
        
        // Make reset function available globally for debugging
        window.resetModuleProgress = resetModuleProgress;
        
        document.addEventListener('DOMContentLoaded', () => {
            moduleManager.initializeModulePage(currentModuleId);
            
            // Load saved progress
            loadProgressFromStorage();
            
            // Initialize sidebar after ensuring module content is available
            setTimeout(() => {
                if (moduleManager.createLessonViewer) {
                    moduleManager.createLessonViewer();
                    // Don't auto-open sidebar - let user click to open it
                }
            }, 100);
            
            // Add module 6 specific quiz questions
            window.moduleContent[6].quiz = {
                questions: [
                    {
                        id: 'q1',
                        text: 'What is data labeling?',
                        options: [
                            'Giving names or categories to data to help AI learn',
                            'Deleting unnecessary files',
                            'Watching videos online',
                            'Writing computer code'
                        ],
                        correct: 0
                    },
                    {
                        id: 'q2',
                        text: 'What is machine learning?',
                        options: [
                            'AI following fixed rules exactly',
                            'AI learning patterns from data',
                            'Humans programming robots manually',
                            'Using a calculator'
                        ],
                        correct: 1
                    },
                    {
                        id: 'q3',
                        text: 'Why do humans need to stay involved when using AI?',
                        options: [
                            'Because AI has limits and needs guidance to work well and fairly',
                            'To write jokes for AI',
                            'To turn AI off every day',
                            'To make AI watch movies'
                        ],
                        correct: 0
                    },
                    {
                        id: 'q4',
                        text: 'What is a model card?',
                        options: [
                            'A game to play with AI',
                            'A summary that explains what an AI model does and its limitations',
                            'A list of computer games',
                            'A password manager'
                        ],
                        correct: 1
                    }
                ]
            };
        });
        
        // Functions for the flow-based layout
        function startActivity(activityId) {
            try {
                console.log('startActivity called with:', activityId);
                const moduleFlow = document.querySelector('.module-flow');
                const heroContainer = document.querySelector('.module-hero-container');
                const activitiesContainer = document.getElementById('activities');
            
            console.log('Elements found:', {
                moduleFlow: !!moduleFlow,
                heroContainer: !!heroContainer,
                activitiesContainer: !!activitiesContainer
            });
            console.log('moduleFlow element:', moduleFlow);
            console.log('heroContainer element:', heroContainer);
            console.log('activitiesContainer element:', activitiesContainer);
            
            console.log('About to hide module flow');
            moduleFlow.style.display = 'none';
            console.log('Module flow hidden');
            if (heroContainer) {
                console.log('Hiding hero container');
                heroContainer.style.display = 'none';
            }
            
            // Hide slideshow container if it exists
            const slideshowContainer = document.getElementById('slideshow-container');
            if (slideshowContainer) {
                console.log('Hiding slideshow container');
                slideshowContainer.style.display = 'none';
            }
            console.log('Setting activities container to block');
            activitiesContainer.style.display = 'block';
            
            console.log('Styling activities container for all activities');
            // Style activities container for all activities
            activitiesContainer.style.position = 'fixed';
            activitiesContainer.style.top = '0';
            activitiesContainer.style.left = '0';
            activitiesContainer.style.width = '100%';
            activitiesContainer.style.height = '100%';
            activitiesContainer.style.zIndex = '10000';
            activitiesContainer.style.background = 'white';
            activitiesContainer.style.overflowY = 'auto';
            activitiesContainer.style.padding = '20px';
            
            // Only show emergency quiz overlay for quiz activity
            if (activityId === 'quiz') {
                // Additional emergency quiz overlay styling for quiz activity only
                activitiesContainer.style.background = 'yellow';
                activitiesContainer.style.border = '10px solid purple';
                
                console.log('Activities container forced visible for quiz');
                console.log('Activities container element:', activitiesContainer);
                console.log('Activities container parent:', activitiesContainer.parentElement);
                console.log('Activities container computed style:', window.getComputedStyle(activitiesContainer));
                
                // Try creating a completely new element to bypass any issues for quiz
                const testDiv = document.createElement('div');
                testDiv.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 99999; overflow-y: auto; padding: 20px;">
                    <button onclick="window.location.href='index.html'" style="position: absolute; top: 10px; right: 10px; background: red; color: white; border: none; padding: 10px; cursor: pointer;">✕ Close</button>
                    <div style="max-width: 800px; margin: 50px auto; background: #f9f9f9; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        <h2 style="color: #333; margin-bottom: 20px;">Knowledge Check Quiz</h2>
                        
                        <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #007cba;">
                            <h3 style="color: #007cba; margin-bottom: 15px;">Question 1: What is data labeling?</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button onclick="selectQuizAnswer(this, true)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">A) Giving names or categories to data to help AI learn</button>
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">B) Deleting unnecessary files</button>
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">C) Watching videos online</button>
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">D) Writing computer code</button>
                            </div>
                            <div class="feedback" style="margin-top: 10px; display: none;"></div>
                        </div>
                        
                        <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #007cba;">
                            <h3 style="color: #007cba; margin-bottom: 15px;">Question 2: What is machine learning?</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">A) AI following fixed rules exactly</button>
                                <button onclick="selectQuizAnswer(this, true)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">B) AI learning patterns from data</button>
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">C) Humans programming robots manually</button>
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">D) Using a calculator</button>
                            </div>
                            <div class="feedback" style="margin-top: 10px; display: none;"></div>
                        </div>
                        
                        <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #007cba;">
                            <h3 style="color: #007cba; margin-bottom: 15px;">Question 3: Why do humans need to stay involved when using AI?</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button onclick="selectQuizAnswer(this, true)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">A) Because AI has limits and needs guidance to work well and fairly</button>
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">B) To write jokes for AI</button>
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">C) To turn AI off every day</button>
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">D) To make AI watch movies</button>
                            </div>
                            <div class="feedback" style="margin-top: 10px; display: none;"></div>
                        </div>
                        
                        <div style="background: white; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 4px solid #007cba;">
                            <h3 style="color: #007cba; margin-bottom: 15px;">Question 4: What is a model card?</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">A) A game to play with AI</button>
                                <button onclick="selectQuizAnswer(this, true)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">B) A summary that explains what an AI model does and its limitations</button>
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">C) A list of computer games</button>
                                <button onclick="selectQuizAnswer(this, false)" style="text-align: left; padding: 12px; border: 2px solid #ddd; background: white; border-radius: 6px; cursor: pointer; transition: all 0.3s;">D) A password manager</button>
                            </div>
                            <div class="feedback" style="margin-top: 10px; display: none;"></div>
                        </div>
                        
                        <!-- Quiz Completion Section -->
                        <div id="quiz-completion" style="display: none; text-align: center; background: white; padding: 30px; margin: 30px 0; border-radius: 8px; border: 2px solid #28a745;">
                            <h3 style="color: #28a745; margin-bottom: 20px;">🎉 Quiz Complete!</h3>
                            <p style="margin-bottom: 20px; color: #666;">Great job completing the Knowledge Check Quiz!</p>
                            <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                                <button onclick="retakeQuiz()" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">🔄 Retake Quiz</button>
                                <button onclick="continueToNext()" style="padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">➡️ Continue</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(testDiv);
            
            // Initialize quiz tracking
            window.quizAnswers = {};
            
            // Add the quiz answer function for the emergency quiz
            window.selectQuizAnswer = function(button, isCorrect) {
                const questionDiv = button.parentElement.parentElement;
                const buttons = questionDiv.querySelectorAll('button[onclick*="selectQuizAnswer"]');
                const feedback = questionDiv.querySelector('.feedback');
                
                // Get question number from the h3 text
                const questionText = questionDiv.querySelector('h3').textContent;
                const questionNumber = questionText.match(/Question (\d+):/)[1];
                
                // Store the answer
                window.quizAnswers[questionNumber] = isCorrect;
                
                // Mark this question as answered
                questionDiv.setAttribute('data-answered', 'true');
                
                // Reset all buttons in this question
                buttons.forEach(btn => {
                    btn.style.background = 'white';
                    btn.style.borderColor = '#ddd';
                    btn.style.color = '#333';
                });
                
                if (isCorrect) {
                    button.style.background = '#d4edda';
                    button.style.borderColor = '#28a745';
                    button.style.color = '#155724';
                    feedback.innerHTML = '<div style="color: #28a745; font-weight: bold; padding: 10px; background: #d4edda; border-radius: 4px;">✓ Correct! Great job!</div>';
                } else {
                    button.style.background = '#f8d7da';
                    button.style.borderColor = '#dc3545';
                    button.style.color = '#721c24';
                    
                    // Highlight correct answer
                    buttons.forEach(btn => {
                        if (btn.onclick.toString().includes('true')) {
                            btn.style.background = '#d4edda';
                            btn.style.borderColor = '#28a745';
                            btn.style.color = '#155724';
                        }
                    });
                    
                    feedback.innerHTML = '<div style="color: #dc3545; font-weight: bold; padding: 10px; background: #f8d7da; border-radius: 4px;">✗ Not quite right. The correct answer is highlighted in green above.</div>';
                }
                
                feedback.style.display = 'block';
                
                // Check if all questions have been answered
                const allQuestions = document.querySelectorAll('[style*="border-left: 4px solid #007cba"]');
                const answeredQuestions = document.querySelectorAll('[data-answered="true"]');
                
                if (answeredQuestions.length === allQuestions.length) {
                    // Calculate score
                    const totalQuestions = Object.keys(window.quizAnswers).length;
                    const correctAnswers = Object.values(window.quizAnswers).filter(answer => answer === true).length;
                    const scorePercentage = Math.round((correctAnswers / totalQuestions) * 100);
                    
                    console.log(`Quiz completed: ${correctAnswers}/${totalQuestions} correct (${scorePercentage}%)`);
                    
                    // Mark quiz as completed
                    console.log('🎯 Main Quiz completed! Marking quiz activity as completed.');
                    markActivityCompleted('quiz');
                    
                    // Show appropriate completion section after a short delay
                    setTimeout(() => {
                        showQuizResults(correctAnswers, totalQuestions, scorePercentage);
                    }, 1000);
                }
            };
            
            // Show quiz results based on score
            window.showQuizResults = function(correctAnswers, totalQuestions, scorePercentage) {
                const completionSection = document.getElementById('quiz-completion');
                if (!completionSection) return;
                
                if (scorePercentage >= 75) {
                    // Passing score - show success message with continue button
                    completionSection.innerHTML = `
                        <h3 style="color: #28a745; margin-bottom: 20px;">🎉 Excellent Work!</h3>
                        <p style="margin-bottom: 15px; color: #333; font-size: 18px; font-weight: bold;">Score: ${correctAnswers}/${totalQuestions} (${scorePercentage}%)</p>
                        <p style="margin-bottom: 20px; color: #666;">Great job! You've mastered the key concepts and can continue to the next section.</p>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="retakeQuiz()" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">🔄 Retake Quiz</button>
                            <button onclick="continueToNext()" style="padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">➡️ Continue</button>
                        </div>
                    `;
                } else {
                    // Below 75% - show retry message with only retake button
                    completionSection.innerHTML = `
                        <h3 style="color: #dc3545; margin-bottom: 20px;">📚 Keep Learning!</h3>
                        <p style="margin-bottom: 15px; color: #333; font-size: 18px; font-weight: bold;">Score: ${correctAnswers}/${totalQuestions} (${scorePercentage}%)</p>
                        <p style="margin-bottom: 20px; color: #666;">You need at least 75% (3 out of 4 questions) to continue. Review the feedback above and try again!</p>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="retakeQuiz()" style="padding: 12px 24px; background: #007cba; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">🔄 Try Again</button>
                        </div>
                    `;
                }
                
                completionSection.style.display = 'block';
                completionSection.style.border = scorePercentage >= 75 ? '2px solid #28a745' : '2px solid #dc3545';
                completionSection.scrollIntoView({ behavior: 'smooth' });
            };
            
            // Add retake and continue functions
            window.retakeQuiz = function() {
                // Reset quiz answers tracking
                window.quizAnswers = {};
                
                // Reset all questions
                const allQuestions = document.querySelectorAll('[style*="border-left: 4px solid #007cba"]');
                allQuestions.forEach(questionDiv => {
                    questionDiv.removeAttribute('data-answered');
                    const buttons = questionDiv.querySelectorAll('button[onclick*="selectQuizAnswer"]');
                    const feedback = questionDiv.querySelector('.feedback');
                    
                    // Reset button styles
                    buttons.forEach(btn => {
                        btn.style.background = 'white';
                        btn.style.borderColor = '#ddd';
                        btn.style.color = '#333';
                    });
                    
                    // Hide feedback
                    if (feedback) {
                        feedback.style.display = 'none';
                    }
                });
                
                // Hide completion section
                const completionSection = document.getElementById('quiz-completion');
                if (completionSection) {
                    completionSection.style.display = 'none';
                }
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            
            window.continueToNext = function() {
                console.log('Continue button clicked from quiz');
                console.log('Slideshow mode:', window.slideshowMode);
                console.log('nextSlide function exists:', typeof window.nextSlide);
                
                // Remove the quiz overlay
                const testDiv = document.querySelector('[style*="position: fixed"][style*="z-index: 99999"]');
                if (testDiv) {
                    console.log('Removing quiz overlay');
                    testDiv.remove();
                }
                
                // Show the slideshow container again (similar to vocab fix)
                const slideshowContainer = document.getElementById('slideshow-container');
                if (slideshowContainer) {
                    console.log('Showing slideshow container');
                    slideshowContainer.style.display = 'block';
                } else {
                    console.log('No slideshow container found');
                }
                
                // Navigate to next slide or fallback
                if (window.slideshowMode && typeof window.nextSlide === 'function') {
                    console.log('Calling nextSlide from quiz');
                    setTimeout(() => window.nextSlide(), 100);
                } else {
                    console.log('Going to module home page from quiz');
                    window.location.href = 'index.html';
                }
            };
            }
            
            console.log('About to route activity:', activityId);
            if (activityId === 'vocab-bank') {
                console.log('Loading vocab bank');
                loadVocabBank();
            } else if (activityId === 'quiz') {
                console.log('Loading quiz activity');
                loadQuizActivity();
            } else if (activityId === 'data-detective') {
                console.log('Loading data detective');
                loadDataDetective();
            } else if (activityId === 'exit-poll') {
                console.log('Loading exit poll');
                loadExitPoll();
            } else {
                console.error('Unknown activity ID:', activityId);
            }
            } catch (error) {
                console.error('Error in startActivity:', error);
                console.error('Stack trace:', error.stack);
            }
        }
        
        function startAssessment() {
            const moduleFlow = document.querySelector('.module-flow');
            const quizContainer = document.getElementById('quiz');
            
            moduleFlow.style.display = 'none';
            quizContainer.style.display = 'block';
            
            loadQuizQuestions();
        }
        
        function backToModule() {
            const moduleFlow = document.querySelector('.module-flow');
            const heroContainer = document.querySelector('.module-hero-container');
            const activitiesContainer = document.getElementById('activities');
            const quizContainer = document.getElementById('quiz');
            
            moduleFlow.style.display = 'block';
            if (heroContainer) {
                heroContainer.style.display = 'block';
            }
            activitiesContainer.style.display = 'none';
            quizContainer.style.display = 'none';
        }
        
        function loadQuizQuestions() {
            const questions = window.moduleContent[6].quiz.questions;
            showQuestion(0);
        }
        
        function showQuestion(index) {
            const questions = window.moduleContent[6].quiz.questions;
            const question = questions[index];
            const container = document.getElementById('question-container');
            
            container.innerHTML = `
                <h3 class="question-text">${question.text}</h3>
                <div class="answer-options">
                    ${question.options.map((option, i) => `
                        <div class="answer-option ${quizAnswers[question.id] === i ? 'selected' : ''}" 
                             onclick="selectAnswer('${question.id}', ${i})">
                            ${option}
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('current-question').textContent = index + 1;
            document.getElementById('total-questions').textContent = questions.length;
            document.querySelector('.quiz-progress-fill').style.width = `${((index + 1) / questions.length) * 100}%`;
            
            document.getElementById('prev-btn').disabled = index === 0;
            document.getElementById('next-btn').style.display = index === questions.length - 1 ? 'none' : 'inline-block';
            document.getElementById('submit-btn').style.display = index === questions.length - 1 ? 'inline-block' : 'none';
        }
        
        function selectAnswer(questionId, answerIndex) {
            quizAnswers[questionId] = answerIndex;
            document.querySelectorAll('.answer-option').forEach((option, i) => {
                option.classList.toggle('selected', i === answerIndex);
            });
        }
        
        function nextQuestion() {
            const questions = window.moduleContent[6].quiz.questions;
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            }
        }
        
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        }
        
        function submitQuiz() {
            const questions = window.moduleContent[6].quiz.questions;
            let correct = 0;
            
            questions.forEach(question => {
                if (quizAnswers[question.id] === question.correct) {
                    correct++;
                }
            });
            
            const score = Math.round((correct / questions.length) * 100);
            
            // Mark quiz as completed (regardless of score)
            markActivityCompleted('quiz');
            if (window.progressTracker) {
                window.progressTracker.markQuizCompleted(currentModuleId, score);
            }
            
            const container = document.getElementById('question-container');
            container.innerHTML = `
                <div class="final-certificate-container">
                    <div class="final-certificate">
                        <h2>🎉 Congratulations! 🎉</h2>
                        <h3>AI Literacy Master Certificate</h3>
                        <p>This certifies that you have successfully completed</p>
                        <h4>Complete AI Literacy Learning Program</h4>
                        <p>All 6 Modules • Final Score: ${score}%</p>
                        <div class="certificate-badge">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                                <path d="M40 15L45 25L56 27L48 35L50 46L40 41L30 46L32 35L24 27L35 25L40 15Z" fill="var(--primary-color)"/>
                                <circle cx="40" cy="40" r="12" stroke="white" stroke-width="2" fill="none"/>
                                <path d="M35 40L38 43L45 36" stroke="white" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <p class="completion-message">You are now a certified AI Literacy Expert!</p>
                        <div class="skills-earned">
                            <h5>Skills You've Mastered:</h5>
                            <div class="skills-list">
                                <span class="skill-badge">AI Understanding</span>
                                <span class="skill-badge">Computational Thinking</span>
                                <span class="skill-badge">System Design</span>
                                <span class="skill-badge">Future Planning</span>
                                <span class="skill-badge">Cybersecurity</span>
                                <span class="skill-badge">Digital Citizenship</span>
                            </div>
                        </div>
                    </div>
                    <button class="quiz-btn" onclick="downloadCertificate()">Download Certificate</button>
                    <button class="quiz-btn" onclick="window.location.href='index.html'">Back to Module</button>
                </div>
            `;
            
            document.querySelector('.quiz-actions').style.display = 'none';
        }
        
        function downloadCertificate() {
            alert('🏆 Master Certificate download feature would be implemented here - your comprehensive achievement has been recorded!');
        }
        
        // BLANK Activity Placeholders
        
        function loadVocabBank() {
            console.log('loadVocabBank called');
            
            // Create a working Vocabulary Bank overlay that bypasses the broken activities container
            const vocabOverlay = document.createElement('div');
            vocabOverlay.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: white !important;
                z-index: 999999 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                place-items: center !important;
                visibility: visible !important;
                overflow-y: auto !important;
                padding: 10px !important;
                box-sizing: border-box !important;
            `;
            
            vocabOverlay.innerHTML = `
                <div class="activity-card" style="padding: 15px; margin: auto; max-width: 1200px; width: 100%; background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                    <div class="activity-header" style="margin-bottom: 10px;">
                        <h3 class="activity-title" style="margin: 0; font-size: 20px;">📚 Vocabulary Matching</h3>
                        <button class="back-to-module-btn" onclick="window.location.href='index.html'" style="padding: 6px 12px; font-size: 12px;">Back to Module</button>
                    </div>
                    <div class="vocabulary-section">
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin-bottom: 15px;">
                            <p style="margin: 0; font-weight: 500; color: #333; font-size: 13px;"><strong>Instructions:</strong> Match each AI term with its correct definition by dragging and dropping. All 8 matches must be correct to continue!</p>
                        </div>
                        
                        <div class="matching-container">
                            <!-- Terms Section (Top) -->
                            <div class="terms-section">
                                <h4 style="text-align: center; color: #007cba; margin-bottom: 8px; font-size: 16px;">🏷️ Terms</h4>
                                <div id="terms-list" class="terms-grid">
                                    <div class="vocab-term" draggable="true" data-term="ai" ondragstart="dragTerm(event)">
                                        <strong>Artificial Intelligence (AI)</strong>
                                    </div>
                                    <div class="vocab-term" draggable="true" data-term="data-labeling" ondragstart="dragTerm(event)">
                                        <strong>Data Labeling</strong>
                                    </div>
                                    <div class="vocab-term" draggable="true" data-term="machine-learning" ondragstart="dragTerm(event)">
                                        <strong>Machine Learning</strong>
                                    </div>
                                    <div class="vocab-term" draggable="true" data-term="algorithm" ondragstart="dragTerm(event)">
                                        <strong>Algorithm</strong>
                                    </div>
                                    <div class="vocab-term" draggable="true" data-term="model-card" ondragstart="dragTerm(event)">
                                        <strong>Model Card</strong>
                                    </div>
                                    <div class="vocab-term" draggable="true" data-term="iteration" ondragstart="dragTerm(event)">
                                        <strong>Iteration</strong>
                                    </div>
                                    <div class="vocab-term" draggable="true" data-term="bias" ondragstart="dragTerm(event)">
                                        <strong>Bias</strong>
                                    </div>
                                    <div class="vocab-term" draggable="true" data-term="human-input" ondragstart="dragTerm(event)">
                                        <strong>Human Input</strong>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Definitions Section (Bottom) -->
                            <div class="definitions-section">
                                <h4 style="text-align: center; color: #28a745; margin-bottom: 8px; font-size: 16px;">📖 Definitions</h4>
                                <div id="definitions-list" class="definitions-grid">
                                    <div class="vocab-definition" data-definition="ai" ondrop="dropTerm(event)" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                                        <div class="definition-text">Computer systems that learn from data and make decisions or predictions.</div>
                                        <div class="drop-indicator">Drop here</div>
                                    </div>
                                    <div class="vocab-definition" data-definition="data-labeling" ondrop="dropTerm(event)" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                                        <div class="definition-text">Giving names or categories to data to help AI learn what it means.</div>
                                        <div class="drop-indicator">Drop here</div>
                                    </div>
                                    <div class="vocab-definition" data-definition="machine-learning" ondrop="dropTerm(event)" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                                        <div class="definition-text">When AI learns patterns from data instead of following fixed rules.</div>
                                        <div class="drop-indicator">Drop here</div>
                                    </div>
                                    <div class="vocab-definition" data-definition="algorithm" ondrop="dropTerm(event)" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                                        <div class="definition-text">A set of instructions that tells a computer how to solve a problem.</div>
                                        <div class="drop-indicator">Drop here</div>
                                    </div>
                                    <div class="vocab-definition" data-definition="model-card" ondrop="dropTerm(event)" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                                        <div class="definition-text">A summary document that explains what an AI model does, its data, and limits.</div>
                                        <div class="drop-indicator">Drop here</div>
                                    </div>
                                    <div class="vocab-definition" data-definition="iteration" ondrop="dropTerm(event)" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                                        <div class="definition-text">Trying, testing, and improving AI systems over time based on feedback.</div>
                                        <div class="drop-indicator">Drop here</div>
                                    </div>
                                    <div class="vocab-definition" data-definition="bias" ondrop="dropTerm(event)" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                                        <div class="definition-text">When AI or data unfairly favors one group or outcome over others.</div>
                                        <div class="drop-indicator">Drop here</div>
                                    </div>
                                    <div class="vocab-definition" data-definition="human-input" ondrop="dropTerm(event)" ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
                                        <div class="definition-text">The decisions and guidance people give to help AI work better.</div>
                                        <div class="drop-indicator">Drop here</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="vocab-actions" style="text-align: center; margin-top: 15px;">
                            <button onclick="checkVocabMatches()" style="padding: 8px 16px; background: #007cba; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px;">
                                ✅ Check My Matches
                            </button>
                            <button onclick="resetVocabMatching()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; margin-left: 8px;">
                                🔄 Reset
                            </button>
                        </div>
                        
                        <div id="vocab-results" style="margin-top: 20px; text-align: center; display: none;"></div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(vocabOverlay);
            console.log('Vocabulary Bank overlay created successfully');
            
            // Initialize the vocabulary matching functionality
            initializeVocabMatching();
        }
        
        // Vocabulary Matching Functions
        function initializeVocabMatching() {
            // Track matches
            window.vocabMatches = {};
            
            // Add CSS styles for the matching interface
            const vocabStyles = document.createElement('style');
            vocabStyles.innerHTML = `
                .matching-container {
                    display: flex;
                    flex-direction: column;
                    gap: 15px;
                    margin: 10px 0;
                }
                
                .terms-section, .definitions-section {
                    background: #f8f9fa;
                    padding: 12px;
                    border-radius: 8px;
                    border: 2px solid #e9ecef;
                }
                
                .terms-grid {
                    display: grid;
                    grid-template-columns: repeat(4, 1fr);
                    gap: 8px;
                }
                
                .definitions-grid {
                    display: grid;
                    grid-template-columns: repeat(4, 1fr);
                    gap: 8px;
                }
                
                .vocab-term {
                    background: linear-gradient(135deg, #007cba, #0056b3);
                    color: white;
                    padding: 8px 10px;
                    margin: 0;
                    border-radius: 6px;
                    cursor: grab;
                    transition: all 0.3s ease;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    user-select: none;
                    font-size: 13px;
                    text-align: center;
                    min-height: 36px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                .vocab-term:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                }
                
                .vocab-term:active {
                    cursor: grabbing;
                    transform: scale(0.98);
                }
                
                .vocab-term.matched {
                    background: linear-gradient(135deg, #28a745, #1e7e34);
                    cursor: default;
                }
                
                .vocab-definition {
                    background: white;
                    border: 2px dashed #dee2e6;
                    padding: 8px;
                    margin: 0;
                    border-radius: 6px;
                    min-height: 50px;
                    position: relative;
                    transition: all 0.3s ease;
                    font-size: 12px;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                }
                
                .vocab-definition.drag-over {
                    border-color: #007cba;
                    background: #e3f2fd;
                    transform: scale(1.02);
                }
                
                .vocab-definition.matched {
                    border-color: #28a745;
                    background: #d4edda;
                    border-style: solid;
                }
                
                .definition-text {
                    color: #333;
                    font-weight: 500;
                    line-height: 1.3;
                    margin: 0;
                    font-size: 12px;
                }
                
                .drop-indicator {
                    position: absolute;
                    bottom: 4px;
                    right: 6px;
                    color: #6c757d;
                    font-style: italic;
                    opacity: 0.5;
                    pointer-events: none;
                    font-size: 10px;
                    background: rgba(255, 255, 255, 0.8);
                    padding: 1px 4px;
                    border-radius: 3px;
                }
                
                .vocab-definition.matched .drop-indicator,
                .vocab-definition.drag-over .drop-indicator {
                    display: none;
                }
                
                .matched-term {
                    background: linear-gradient(135deg, #28a745, #1e7e34);
                    color: white;
                    padding: 10px;
                    border-radius: 6px;
                    margin-bottom: 10px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .remove-match {
                    background: rgba(255,255,255,0.2);
                    border: none;
                    color: white;
                    border-radius: 50%;
                    width: 24px;
                    height: 24px;
                    cursor: pointer;
                    font-weight: bold;
                }
                
                @media (max-width: 768px) {
                    .terms-grid, .definitions-grid {
                        grid-template-columns: repeat(2, 1fr);
                        gap: 6px;
                    }
                    
                    .matching-container {
                        gap: 10px;
                    }
                    
                    .vocab-term {
                        font-size: 11px;
                        padding: 6px;
                        min-height: 32px;
                    }
                    
                    .vocab-definition {
                        font-size: 11px;
                        min-height: 45px;
                        padding: 6px;
                    }
                }
            `;
            document.head.appendChild(vocabStyles);
        }
        
        function dragTerm(event) {
            console.log('Dragging term:', event.target.dataset.term);
            event.dataTransfer.setData("text/plain", event.target.dataset.term);
            event.target.style.opacity = "0.5";
        }
        
        function allowDrop(event) {
            event.preventDefault();
        }
        
        function dragEnter(event) {
            event.preventDefault();
            event.target.classList.add('drag-over');
        }
        
        function dragLeave(event) {
            event.target.classList.remove('drag-over');
        }
        
        function dropTerm(event) {
            event.preventDefault();
            const termId = event.dataTransfer.getData("text/plain");
            const definitionElement = event.target.closest('.vocab-definition');
            const definitionId = definitionElement.dataset.definition;
            
            console.log('Dropping term:', termId, 'on definition:', definitionId);
            
            // Remove drag-over styling
            definitionElement.classList.remove('drag-over');
            
            // Check if this definition already has a match
            const existingMatch = definitionElement.querySelector('.matched-term');
            if (existingMatch) {
                // Remove the existing match and restore the term
                const existingTermId = existingMatch.dataset.matchedTerm;
                restoreTerm(existingTermId);
                existingMatch.remove();
                delete window.vocabMatches[definitionId];
            }
            
            // Find and hide the term
            const termElement = document.querySelector(`[data-term="${termId}"]`);
            if (termElement) {
                termElement.style.display = 'none';
                
                // Create matched display
                const matchedDisplay = document.createElement('div');
                matchedDisplay.className = 'matched-term';
                matchedDisplay.dataset.matchedTerm = termId;
                matchedDisplay.innerHTML = `
                    <span>${termElement.textContent}</span>
                    <button class="remove-match" onclick="removeMatch('${termId}', '${definitionId}')">×</button>
                `;
                
                // Add to definition
                definitionElement.insertBefore(matchedDisplay, definitionElement.firstChild);
                definitionElement.classList.add('matched');
                
                // Track the match
                window.vocabMatches[definitionId] = termId;
                
                console.log('Current matches:', window.vocabMatches);
            }
        }
        
        function removeMatch(termId, definitionId) {
            console.log('Removing match:', termId, definitionId);
            
            // Restore the term to the terms list
            restoreTerm(termId);
            
            // Remove from definition
            const definitionElement = document.querySelector(`[data-definition="${definitionId}"]`);
            const matchedTerm = definitionElement.querySelector('.matched-term');
            if (matchedTerm) {
                matchedTerm.remove();
                definitionElement.classList.remove('matched');
                delete window.vocabMatches[definitionId];
            }
        }
        
        function restoreTerm(termId) {
            const termElement = document.querySelector(`[data-term="${termId}"]`);
            if (termElement) {
                termElement.style.display = 'block';
                termElement.style.opacity = '1';
            }
        }
        
        function checkVocabMatches() {
            const totalTerms = 8;
            const correctMatches = Object.keys(window.vocabMatches).filter(defId => {
                return window.vocabMatches[defId] === defId;
            }).length;
            
            console.log('Checking matches. Correct:', correctMatches, 'Total:', totalTerms);
            console.log('Matches:', window.vocabMatches);
            
            const resultsDiv = document.getElementById('vocab-results');
            
            if (correctMatches === totalTerms) {
                // All correct! Mark vocabulary as completed
                markActivityCompleted('vocab-bank');
                
                resultsDiv.innerHTML = `
                    <div style="background: #d4edda; border: 2px solid #28a745; border-radius: 8px; padding: 20px; margin: 20px 0;">
                        <h3 style="color: #28a745; margin: 0 0 10px 0;">🎉 Perfect Match!</h3>
                        <p style="margin: 0; color: #333;">Excellent work! You've correctly matched all ${totalTerms} terms with their definitions.</p>
                        <button onclick="continueFromVocabFixed(this)" style="margin-top: 15px; padding: 12px 24px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            ✨ Continue Learning
                        </button>
                    </div>
                `;
            } else {
                // Some incorrect
                resultsDiv.innerHTML = `
                    <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 20px; margin: 20px 0;">
                        <h3 style="color: #856404; margin: 0 0 10px 0;">📚 Keep Trying!</h3>
                        <p style="margin: 0; color: #333;">You got ${correctMatches} out of ${totalTerms} matches correct. Review the terms and try again!</p>
                        <p style="margin: 10px 0 0 0; font-size: 14px; color: #6c757d;"><em>Hint: Make sure each term matches exactly with its definition.</em></p>
                    </div>
                `;
            }
            
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        function resetVocabMatching() {
            // Clear all matches
            window.vocabMatches = {};
            
            // Restore all terms
            const allTerms = document.querySelectorAll('.vocab-term');
            allTerms.forEach(term => {
                term.style.display = 'block';
                term.style.opacity = '1';
            });
            
            // Clear all definitions
            const allDefinitions = document.querySelectorAll('.vocab-definition');
            allDefinitions.forEach(def => {
                const matchedTerm = def.querySelector('.matched-term');
                if (matchedTerm) {
                    matchedTerm.remove();
                }
                def.classList.remove('matched');
            });
            
            // Hide results
            document.getElementById('vocab-results').style.display = 'none';
            
            console.log('Vocabulary matching reset');
        }
        
        function continueFromVocabFixed(buttonElement) {
            console.log('Continue Learning clicked - fixed version');
            
            // Try multiple ways to find and remove the overlay
            let overlay = buttonElement.closest('[style*="position: fixed"]');
            console.log('Found overlay with position fixed:', overlay);
            
            if (!overlay) {
                overlay = buttonElement.closest('[style*="z-index: 999999"]');
                console.log('Found overlay with z-index:', overlay);
            }
            
            if (!overlay) {
                overlay = document.querySelector('[style*="z-index: 999999"]');
                console.log('Found overlay via document query:', overlay);
            }
            
            if (overlay) {
                console.log('Removing overlay');
                overlay.remove();
                
                // Show the slideshow container again
                const slideshowContainer = document.getElementById('slideshow-container');
                if (slideshowContainer) {
                    console.log('Showing slideshow container');
                    slideshowContainer.style.display = 'block';
                } else {
                    console.log('No slideshow container found');
                }
                
                // Navigate to next slide or dashboard
                if (window.slideshowMode && window.nextSlide) { 
                    console.log('Calling nextSlide from vocab'); 
                    setTimeout(() => window.nextSlide(), 50); 
                } else { 
                    console.log('Going to module home from vocab - slideshowMode:', window.slideshowMode, 'nextSlide:', typeof window.nextSlide); 
                    window.location.href = 'index.html'; 
                }
            } else {
                console.log('No overlay found to remove - trying direct navigation');
                
                // Show the slideshow container anyway
                const slideshowContainer = document.getElementById('slideshow-container');
                if (slideshowContainer) {
                    console.log('Showing slideshow container (fallback)');
                    slideshowContainer.style.display = 'block';
                }
                
                // If we can't find the overlay, just try to navigate
                if (window.slideshowMode && window.nextSlide) { 
                    console.log('Direct nextSlide call'); 
                    window.nextSlide(); 
                } else { 
                    console.log('Direct module home navigation'); 
                    window.location.href = 'index.html'; 
                }
            }
        }
        
        function loadQuizActivity() {
            console.log('loadQuizActivity called');
            const container = document.querySelector('#activities .activities-container');
            console.log('Container found:', container);
            
            if (!container) {
                console.error('Activities container not found!');
                return;
            }
            
            // Start with a simple test to see if anything shows up
            container.innerHTML = `
                <div class="activity-card" style="background: white; border: 2px solid red; padding: 20px; margin: 20px;">
                    <h1 style="color: red; font-size: 24px;">TEST: Quiz is loading!</h1>
                    <div class="activity-header">
                        <h3 class="activity-title">Knowledge Check Quiz</h3>
                        <button class="back-to-module-btn" onclick="window.location.href='index.html'" style="background: blue; color: white; padding: 10px;">Back to Module</button>
                    </div>
                    <div class="quiz-section">
                        <h3 style="color: green;">DATA Knowledge Check</h3>
                        <div class="data-quiz-container">
                            <div class="quiz-question" data-question="1" style="background: #f0f0f0; padding: 15px; margin: 10px 0; border: 1px solid #ccc;">
                                <h4 style="color: blue; margin-bottom: 10px;">What is data labeling?</h4>
                                <div class="quiz-options">
                                    <button class="quiz-option" data-answer="correct" onclick="selectDataQuizAnswer(this, 1, true)" style="display: block; width: 100%; padding: 10px; margin: 5px 0; background: #e7f3ff; border: 1px solid #007cba; cursor: pointer;">A) Giving names or categories to data to help AI learn</button>
                                    <button class="quiz-option" data-answer="incorrect" onclick="selectDataQuizAnswer(this, 1, false)" style="display: block; width: 100%; padding: 10px; margin: 5px 0; background: #fff; border: 1px solid #ccc; cursor: pointer;">B) Deleting unnecessary files</button>
                                    <button class="quiz-option" data-answer="incorrect" onclick="selectDataQuizAnswer(this, 1, false)" style="display: block; width: 100%; padding: 10px; margin: 5px 0; background: #fff; border: 1px solid #ccc; cursor: pointer;">C) Watching videos online</button>
                                    <button class="quiz-option" data-answer="incorrect" onclick="selectDataQuizAnswer(this, 1, false)" style="display: block; width: 100%; padding: 10px; margin: 5px 0; background: #fff; border: 1px solid #ccc; cursor: pointer;">D) Writing computer code</button>
                                </div>
                                <div class="quiz-feedback" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            console.log('Quiz HTML loaded successfully. Container content:', container.innerHTML.substring(0, 100) + '...');
        }
        
        function loadDataDetective() {
            console.log('loadDataDetective called');
            
            // Create a working Data Detective overlay that bypasses the broken activities container
            const detectiveOverlay = document.createElement('div');
            detectiveOverlay.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: white !important;
                z-index: 999999 !important;
                display: block !important;
                visibility: visible !important;
                overflow-y: auto !important;
                padding: 20px !important;
            `;
            detectiveOverlay.innerHTML = `
                <div class="activity-card" style="background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); padding: 30px; margin: 20px auto; max-width: 900px;">
                    <div class="activity-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 class="activity-title" style="color: #333; font-size: 24px; margin: 0;">Data Detective 🔍</h3>
                        <button onclick="window.location.href='index.html'" style="background: #6c757d; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">Back to Module</button>
                    </div>
                    <div class="data-detective-game">
                        <div class="detective-intro" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                            <p style="margin: 0; font-weight: 500; color: #333;"><strong>Mission:</strong> You're a Data Detective! An AI company wants to build a "Student Success Predictor" but their data might have problems. Help them find and fix the issues!</p>
                        </div>
                        <div class="detective-step" id="step1">
                            <h4 style="color: #007cba; margin-bottom: 15px;">Step 1: Look at the Data</h4>
                            <p>Here are 12 student records. Examine them carefully:</p>
                            <div class="student-data" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin: 20px 0;">
                                <div class="student-card" style="background: #e3f2fd; padding: 15px; border-radius: 8px; border: 2px solid #2196f3;">
                                    <div class="student-info" style="font-weight: 500;">Sarah, 16, Gaming Club, Math: A, Science: B+</div>
                                </div>
                                <div class="student-card" style="background: #fce4ec; padding: 15px; border-radius: 8px; border: 2px solid #e91e63;">
                                    <div class="student-info" style="font-weight: 500;">Emma, 15, Art Club, Math: B, Science: A-</div>
                                </div>
                                <div class="student-card" style="background: #e8f5e8; padding: 15px; border-radius: 8px; border: 2px solid #4caf50;">
                                    <div class="student-info" style="font-weight: 500;">Michael, 17, Football, Math: C+, Science: B</div>
                                </div>
                                <div class="student-card" style="background: #fff3e0; padding: 15px; border-radius: 8px; border: 2px solid #ff9800;">
                                    <div class="student-info" style="font-weight: 500;">David, 16, Chess Club, Math: A+, Science: A</div>
                                </div>
                                <div class="student-card" style="background: #f3e5f5; padding: 15px; border-radius: 8px; border: 2px solid #9c27b0;">
                                    <div class="student-info" style="font-weight: 500;">Jessica, 15, Dance, Math: B-, Science: B+</div>
                                </div>
                                <div class="student-card" style="background: #e1f5fe; padding: 15px; border-radius: 8px; border: 2px solid #00bcd4;">
                                    <div class="student-info" style="font-weight: 500;">Ryan, 17, Basketball, Math: B, Science: C+</div>
                                </div>
                                <div class="student-card" style="background: #f1f8e9; padding: 15px; border-radius: 8px; border: 2px solid #8bc34a;">
                                    <div class="student-info" style="font-weight: 500;">Ashley, 16, Drama Club, Math: A-, Science: B+</div>
                                </div>
                                <div class="student-card" style="background: #ffebee; padding: 15px; border-radius: 8px; border: 2px solid #f44336;">
                                    <div class="student-info" style="font-weight: 500;">Jake, 17, Soccer, Math: C, Science: B-</div>
                                </div>
                                <div class="student-card" style="background: #e8eaf6; padding: 15px; border-radius: 8px; border: 2px solid #3f51b5;">
                                    <div class="student-info" style="font-weight: 500;">Mia, 15, Robotics, Math: A, Science: A+</div>
                                </div>
                                <div class="student-card" style="background: #fff8e1; padding: 15px; border-radius: 8px; border: 2px solid #ffc107;">
                                    <div class="student-info" style="font-weight: 500;">Tyler, 16, Baseball, Math: B+, Science: B</div>
                                </div>
                                <div class="student-card" style="background: #fce4ec; padding: 15px; border-radius: 8px; border: 2px solid #e91e63;">
                                    <div class="student-info" style="font-weight: 500;">Olivia, 15, Music, Math: B+, Science: A-</div>
                                </div>
                                <div class="student-card" style="background: #e0f2f1; padding: 15px; border-radius: 8px; border: 2px solid #009688;">
                                    <div class="student-info" style="font-weight: 500;">Ethan, 17, Debate, Math: A-, Science: A</div>
                                </div>
                            </div>
                            <p style="margin: 20px 0; color: #666;">Look closely at this data. What patterns do you notice? What might be missing?</p>
                            <button onclick="nextDetectiveStep(2)" style="background: #007cba; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 15px;">Continue Investigation →</button>
                        </div>
                        
                        <div class="detective-step" id="step2" style="display: none;">
                            <h4 style="color: #007cba; margin-bottom: 15px;">Step 2: Sort the Students</h4>
                            <p>Drag each student into one of these groups based on their activities and grades:</p>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                                <div class="sort-group" id="high-achievers" style="background: #e8f5e8; border: 2px dashed #4caf50; border-radius: 10px; padding: 20px; min-height: 150px;">
                                    <h5 style="color: #2e7d32; margin: 0 0 15px 0; text-align: center;">🏆 High Achievers</h5>
                                    <p style="font-size: 14px; color: #666; text-align: center; margin-bottom: 15px;">Students likely to succeed</p>
                                    <div class="drop-zone" ondrop="dropStudent(event)" ondragover="allowDrop(event)"></div>
                                </div>
                                
                                <div class="sort-group" id="at-risk" style="background: #ffebee; border: 2px dashed #f44336; border-radius: 10px; padding: 20px; min-height: 150px;">
                                    <h5 style="color: #c62828; margin: 0 0 15px 0; text-align: center;">⚠️ At Risk</h5>
                                    <p style="font-size: 14px; color: #666; text-align: center; margin-bottom: 15px;">Students who might struggle</p>
                                    <div class="drop-zone" ondrop="dropStudent(event)" ondragover="allowDrop(event)"></div>
                                </div>
                            </div>
                            
                            <div style="background: #fff3e0; border: 2px dashed #ff9800; border-radius: 10px; padding: 20px; margin: 20px 0;">
                                <h5 style="color: #ef6c00; margin: 0 0 15px 0; text-align: center;">📊 Unsorted Students</h5>
                                <div id="unsorted-students" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                                    <!-- Students will be moved here initially -->
                                </div>
                            </div>
                            
                            <button id="step2-continue" onclick="nextDetectiveStep(3)" style="background: #007cba; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 15px; display: none;">Continue to Analysis →</button>
                        </div>
                        
                        <div class="detective-step" id="step3" style="display: none;">
                            <h4 style="color: #007cba; margin-bottom: 15px;">Step 3: Identify Problems</h4>
                            <p>Now let's think critically about this data. Check all the problems you notice:</p>
                            
                            <!-- Reference data for easy viewing -->
                            <div class="reference-data" style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                                <h5 style="margin: 0 0 10px 0; color: #1976d2;">📊 Student Data Reference</h5>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; font-size: 14px;">
                                    <div>Sarah, 16, Gaming Club, Math: A, Science: B+</div>
                                    <div>Emma, 15, Art Club, Math: B, Science: A-</div>
                                    <div>Michael, 17, Football, Math: C+, Science: B</div>
                                    <div>David, 16, Chess Club, Math: A+, Science: A</div>
                                    <div>Jessica, 15, Dance, Math: B-, Science: B+</div>
                                    <div>Ryan, 17, Basketball, Math: B, Science: C+</div>
                                    <div>Ashley, 16, Drama Club, Math: A-, Science: B+</div>
                                    <div>Jake, 17, Soccer, Math: C, Science: B-</div>
                                    <div>Mia, 15, Robotics, Math: A, Science: A+</div>
                                    <div>Tyler, 16, Baseball, Math: B+, Science: B</div>
                                    <div>Olivia, 15, Music, Math: B+, Science: A-</div>
                                    <div>Ethan, 17, Debate, Math: A-, Science: A</div>
                                </div>
                            </div>
                            
                            <div class="problem-checklist" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                                <label style="display: flex; align-items: center; margin: 15px 0; cursor: pointer;">
                                    <input type="checkbox" class="problem-check" value="gender-bias" style="margin-right: 10px;">
                                    <span>The data seems to have stereotypes about what activities boys vs girls do</span>
                                </label>
                                <label style="display: flex; align-items: center; margin: 15px 0; cursor: pointer;">
                                    <input type="checkbox" class="problem-check" value="missing-diversity" style="margin-right: 10px;">
                                    <span>All students seem to be from similar backgrounds - missing diversity</span>
                                </label>
                                <label style="display: flex; align-items: center; margin: 15px 0; cursor: pointer;">
                                    <input type="checkbox" class="problem-check" value="small-sample" style="margin-right: 10px;">
                                    <span>Only 12 students isn't enough data to predict success for all students</span>
                                </label>
                                <label style="display: flex; align-items: center; margin: 15px 0; cursor: pointer;">
                                    <input type="checkbox" class="problem-check" value="limited-activities" style="margin-right: 10px;">
                                    <span>Limited types of activities represented</span>
                                </label>
                                <label style="display: flex; align-items: center; margin: 15px 0; cursor: pointer;">
                                    <input type="checkbox" class="problem-check" value="grade-bias" style="margin-right: 10px;">
                                    <span>Only looking at current grades, not potential or growth</span>
                                </label>
                                <label style="display: flex; align-items: center; margin: 15px 0; cursor: pointer;">
                                    <input type="checkbox" class="problem-check" value="no-context" style="margin-right: 10px;">
                                    <span>Missing important context like family situation, learning differences, etc.</span>
                                </label>
                            </div>
                            
                            <button onclick="nextDetectiveStep(4)" style="background: #007cba; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 15px;">Continue to Solutions →</button>
                        </div>
                        
                        <div class="detective-step" id="step4" style="display: none;">
                            <h4 style="color: #007cba; margin-bottom: 15px;">Step 4: Fix the Data</h4>
                            <p>How would you improve this dataset to help AI make better, fairer predictions?</p>
                            
                            <!-- Reference data for easy viewing -->
                            <div class="reference-data" style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                                <h5 style="margin: 0 0 10px 0; color: #1976d2;">📊 Student Data Reference</h5>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; font-size: 14px;">
                                    <div>Sarah, 16, Gaming Club, Math: A, Science: B+</div>
                                    <div>Emma, 15, Art Club, Math: B, Science: A-</div>
                                    <div>Michael, 17, Football, Math: C+, Science: B</div>
                                    <div>David, 16, Chess Club, Math: A+, Science: A</div>
                                    <div>Jessica, 15, Dance, Math: B-, Science: B+</div>
                                    <div>Ryan, 17, Basketball, Math: B, Science: C+</div>
                                    <div>Ashley, 16, Drama Club, Math: A-, Science: B+</div>
                                    <div>Jake, 17, Soccer, Math: C, Science: B-</div>
                                    <div>Mia, 15, Robotics, Math: A, Science: A+</div>
                                    <div>Tyler, 16, Baseball, Math: B+, Science: B</div>
                                    <div>Olivia, 15, Music, Math: B+, Science: A-</div>
                                    <div>Ethan, 17, Debate, Math: A-, Science: A</div>
                                </div>
                            </div>
                            
                            <div class="solution-form" style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin: 20px 0;">
                                <div class="solution-question" style="margin-bottom: 25px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 10px; color: #333;">What types of students are missing from this data?</label>
                                    <textarea class="solution-input" id="missing-students" placeholder="Think about different backgrounds, learning styles, interests..." style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; min-height: 80px; font-family: inherit; resize: vertical;"></textarea>
                                </div>
                                
                                <div class="solution-question" style="margin-bottom: 25px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 10px; color: #333;">What additional information should we collect?</label>
                                    <textarea class="solution-input" id="additional-info" placeholder="What other factors might predict student success?" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; min-height: 80px; font-family: inherit; resize: vertical;"></textarea>
                                </div>
                                
                                <div class="solution-question" style="margin-bottom: 25px;">
                                    <label style="display: block; font-weight: 600; margin-bottom: 10px; color: #333;">How can we make sure the AI treats all students fairly?</label>
                                    <textarea class="solution-input" id="fairness-measures" placeholder="What rules or checks should we put in place?" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; min-height: 80px; font-family: inherit; resize: vertical;"></textarea>
                                </div>
                            </div>
                            
                            <button onclick="completeDetective()" style="background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 15px;">Complete Investigation 🎉</button>
                        </div>
                        
                        <div class="detective-step" id="step5" style="display: none;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; text-align: center; margin: 20px 0;">
                                <h3 style="margin: 0 0 20px 0; font-size: 28px;">🎉 Congratulations, Data Detective! 🎉</h3>
                                <p style="font-size: 18px; margin: 15px 0;">You've successfully completed your investigation!</p>
                                
                                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 20px 0;">
                                    <h4 style="margin: 0 0 15px 0;">What You Discovered:</h4>
                                    <ul style="text-align: left; max-width: 600px; margin: 0 auto;">
                                        <li style="margin: 8px 0;">📊 Small datasets can lead to biased AI decisions</li>
                                        <li style="margin: 8px 0;">👥 Missing diversity in data creates unfair outcomes</li>
                                        <li style="margin: 8px 0;">🎯 Context matters more than just grades and activities</li>
                                        <li style="margin: 8px 0;">⚖️ AI systems need human oversight for fairness</li>
                                        <li style="margin: 8px 0;">🔍 Always question the data behind AI decisions</li>
                                    </ul>
                                </div>
                                
                                <p style="font-size: 16px; margin: 20px 0;">You're now ready to help build fairer, more inclusive AI systems!</p>
                                
                                <button onclick="continueFromDetective()" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 20px;">Continue Learning →</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(detectiveOverlay);
            console.log('Data Detective overlay created successfully');
            
            // Initialize the drag-and-drop functionality for Step 2
            setTimeout(() => {
                initializeDetectiveDragDrop();
            }, 100);
            
            // Add the detective functions to the overlay
            window.nextDetectiveStep = function(stepNumber) {
                console.log('Moving to detective step:', stepNumber);
                console.log('Available steps:', detectiveOverlay.querySelectorAll('.detective-step'));
                
                // Hide all steps
                const allSteps = detectiveOverlay.querySelectorAll('.detective-step');
                allSteps.forEach(step => step.style.display = 'none');
                
                // Show the requested step
                const targetStep = detectiveOverlay.querySelector('#step' + stepNumber);
                console.log('Target step found:', targetStep);
                if (targetStep) {
                    targetStep.style.display = 'block';
                    console.log('Showing step', stepNumber);
                    
                    // Special handling for step 2 - move student cards to unsorted area
                    if (stepNumber === 2) {
                        console.log('Initializing step 2 drag and drop');
                        moveStudentsToUnsorted();
                    }
                } else {
                    console.error('Could not find step', stepNumber);
                }
            };
            
            window.completeDetective = function() {
                console.log('Completing detective investigation');
                
                // Mark Data Detective as completed
                markActivityCompleted('data-detective');
                
                // Collect the user's solutions
                const missingStudents = detectiveOverlay.querySelector('#missing-students').value;
                const additionalInfo = detectiveOverlay.querySelector('#additional-info').value;
                const fairnessMeasures = detectiveOverlay.querySelector('#fairness-measures').value;
                
                // Store the solutions (could be saved to progress tracking)
                window.detectiveSolutions = {
                    missingStudents: missingStudents,
                    additionalInfo: additionalInfo,
                    fairnessMeasures: fairnessMeasures,
                    completedAt: new Date().toISOString()
                };
                
                console.log('Detective solutions saved:', window.detectiveSolutions);
                
                // Show completion step
                window.nextDetectiveStep(5);
            };
            
            window.continueFromDetective = function() {
                console.log('Continue Learning clicked');
                console.log('slideshowMode:', window.slideshowMode);
                console.log('nextSlide function:', typeof window.nextSlide);
                
                // Remove the detective overlay
                detectiveOverlay.remove();
                
                // Navigate based on mode
                if (window.slideshowMode && window.nextSlide) {
                    console.log('Calling nextSlide');
                    
                    // First, restore the slideshow container
                    const slideshowContainer = document.getElementById('slideshow-container');
                    if (slideshowContainer) {
                        console.log('Restoring slideshow container');
                        slideshowContainer.style.display = 'block';
                    }
                    
                    // Then advance to next slide
                    setTimeout(() => {
                        try {
                            window.nextSlide();
                            console.log('nextSlide() called successfully');
                        } catch (error) {
                            console.error('Error calling nextSlide:', error);
                            // Fallback: just show the slideshow
                            if (slideshowContainer) {
                                slideshowContainer.style.display = 'block';
                            }
                        }
                    }, 100);
                } else if (window.backToModule) {
                    console.log('Calling backToModule');
                    window.backToModule();
                } else {
                    console.log('No navigation function found');
                    // Fallback: show slideshow if it exists
                    const slideshowContainer = document.getElementById('slideshow-container');
                    if (slideshowContainer) {
                        slideshowContainer.style.display = 'block';
                    }
                }
            };
            
            window.allowDrop = function(event) {
                event.preventDefault();
            };
            
            window.dropStudent = function(event) {
                event.preventDefault();
                const studentId = event.dataTransfer.getData('text/plain');
                const studentCard = detectiveOverlay.querySelector(`[data-student-id="${studentId}"]`);
                
                if (studentCard) {
                    // Find the drop zone within the group
                    const dropZone = event.target.closest('.sort-group').querySelector('.drop-zone');
                    dropZone.appendChild(studentCard);
                    
                    // Check if all students are sorted
                    checkIfAllStudentsSorted();
                }
            };
            
            function moveStudentsToUnsorted() {
                const unsortedArea = detectiveOverlay.querySelector('#unsorted-students');
                const originalCards = detectiveOverlay.querySelectorAll('.student-card');
                
                // Create draggable versions of the student cards
                originalCards.forEach((card, index) => {
                    const dragCard = document.createElement('div');
                    dragCard.className = 'student-card draggable-card';
                    dragCard.draggable = true;
                    dragCard.setAttribute('data-student-id', index + 1);
                    dragCard.style.cssText = card.style.cssText + '; cursor: grab; min-width: 200px; margin: 5px;';
                    dragCard.innerHTML = card.innerHTML;
                    
                    dragCard.addEventListener('dragstart', function(e) {
                        e.dataTransfer.setData('text/plain', this.getAttribute('data-student-id'));
                        this.style.opacity = '0.5';
                    });
                    
                    dragCard.addEventListener('dragend', function(e) {
                        this.style.opacity = '1';
                    });
                    
                    unsortedArea.appendChild(dragCard);
                });
            }
            
            function checkIfAllStudentsSorted() {
                const unsortedArea = detectiveOverlay.querySelector('#unsorted-students');
                const continueBtn = detectiveOverlay.querySelector('#step2-continue');
                
                if (unsortedArea.children.length === 0) {
                    continueBtn.style.display = 'inline-block';
                    continueBtn.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            
            const container = document.querySelector('#activities .activities-container');
            console.log('Data Detective container found:', container);
            console.log('Container parent:', container ? container.parentElement : 'none');
            
            if (!container) {
                console.error('Data Detective: activities-container not found!');
                return;
            }
            
            container.innerHTML = `
                <div class="activity-card" style="background: white; border: 2px solid red; padding: 20px; margin: 20px;">
                    <div class="activity-header">
                        <h3 class="activity-title">Data Detective 🔍</h3>
                        <button class="back-to-module-btn" onclick="window.location.href='index.html'">Back to Module</button>
                    </div>
                    <div class="data-detective-game">
                        <div class="detective-intro">
                            <p><strong>Mission:</strong> You're a Data Detective! An AI company wants to build a "Student Success Predictor" but their data might have problems. Help them find and fix the issues!</p>
                        </div>

                        <div class="detective-step" id="step1">
                            <h4>Step 1: Look at the Data</h4>
                            <p>Here are 12 student records. Examine them carefully:</p>
                            <div class="student-data" id="student-data">
                                <div class="student-card" draggable="true" data-id="1">
                                    <div class="student-info">Sarah, 16, Gaming Club, Math: A, Science: B+</div>
                                </div>
                                <div class="student-card" draggable="true" data-id="2">
                                    <div class="student-info">Michael, 17, Football Team, Math: B, Science: A</div>
                                </div>
                                <div class="student-card" draggable="true" data-id="3">
                                    <div class="student-info">Aisha, 15, Robotics Club, Math: A+, Science: A</div>
                                </div>
                                <div class="student-card" draggable="true" data-id="4">
                                    <div class="student-info">Jake, 18, Basketball Team, Math: C, Science: B</div>
                                </div>
                                <div class="student-card" draggable="true" data-id="5">
                                    <div class="student-info">Emma, 16, Art Club, Math: B+, Science: B</div>
                                </div>
                                <div class="student-card" draggable="true" data-id="6">
                                    <div class="student-info">David, 17, Chess Club, Math: A, Science: A-</div>
                                </div>
                                <div class="student-card" draggable="true" data-id="7">
                                    <div class="student-info">Tyler, 18, Football Team, Math: C+, Science: C</div>
                                </div>
                                <div class="student-card" draggable="true" data-id="8">
                                    <div class="student-info">Sophie, 15, Science Club, Math: A, Science: A+</div>
                                </div>
                                <div class="student-card" draggable="true" data-id="9">
                                    <div class="student-info">Marcus, 17, Basketball Team, Math: B-, Science: C+</div>
                                </div>
                                <div class="student-card" draggable="true" data-id="10">
                                    <div class="student-info">Lily, 16, Drama Club, Math: B, Science: B+</div>
                                </div>
                                <div class="student-card" draggable="true" data-id="11">
                                    <div class="student-info">Ryan, 18, Gaming Club, Math: B+, Science: B</div>
                                </div>
                                <div class="student-card" draggable="true" data-id="12">
                                    <div class="student-info">Zoe, 15, Debate Team, Math: A-, Science: A</div>
                                </div>
                            </div>
                            <button class="detective-btn" onclick="nextDetectiveStep(2)">Continue to Sorting →</button>
                        </div>

                        <div class="detective-step" id="step2" style="display: none;">
                            <h4>Step 2: Sort into Groups</h4>
                            <p>Drag students into groups based on what you think is similar about them:</p>
                            <div class="sorting-area">
                                <div class="sort-group" id="group1">
                                    <div class="group-header">
                                        <input type="text" placeholder="Name this group..." class="group-label" id="label1">
                                    </div>
                                    <div class="group-dropzone" ondrop="drop(event, 'group1')" ondragover="allowDrop(event)">
                                        Drop students here
                                    </div>
                                </div>
                                <div class="sort-group" id="group2">
                                    <div class="group-header">
                                        <input type="text" placeholder="Name this group..." class="group-label" id="label2">
                                    </div>
                                    <div class="group-dropzone" ondrop="drop(event, 'group2')" ondragover="allowDrop(event)">
                                        Drop students here
                                    </div>
                                </div>
                                <div class="sort-group" id="group3">
                                    <div class="group-header">
                                        <input type="text" placeholder="Name this group..." class="group-label" id="label3">
                                    </div>
                                    <div class="group-dropzone" ondrop="drop(event, 'group3')" ondragover="allowDrop(event)">
                                        Drop students here
                                    </div>
                                </div>
                            </div>
                            <button class="detective-btn" onclick="nextDetectiveStep(3)">Continue to Analysis →</button>
                        </div>

                        <div class="detective-step" id="step3" style="display: none;">
                            <h4>Step 3: Identify Problems</h4>
                            <p>Now let's think critically about this data. Check all the problems you notice:</p>
                            <div class="problem-checklist">
                                <label><input type="checkbox" class="problem-check" value="gender-bias"> The data seems to have stereotypes about what activities boys vs girls do</label>
                                <label><input type="checkbox" class="problem-check" value="missing-diversity"> All students seem to be from similar backgrounds - missing diversity</label>
                                <label><input type="checkbox" class="problem-check" value="small-sample"> Only 12 students isn't enough data to predict success for all students</label>
                                <label><input type="checkbox" class="problem-check" value="limited-activities"> Limited types of activities represented</label>
                                <label><input type="checkbox" class="problem-check" value="grade-bias"> Only looking at current grades, not potential or growth</label>
                                <label><input type="checkbox" class="problem-check" value="no-context"> Missing important context like family situation, learning differences, etc.</label>
                            </div>
                            <button class="detective-btn" onclick="nextDetectiveStep(4)">Continue to Solutions →</button>
                        </div>

                        <div class="detective-step" id="step4" style="display: none;">
                            <h4>Step 4: Fix the Data</h4>
                            <p>How would you improve this dataset to help AI make better, fairer predictions?</p>
                            <div class="solution-form">
                                <div class="solution-question">
                                    <label>What types of students are missing from this data?</label>
                                    <textarea class="solution-input" id="missing-students" placeholder="Think about different backgrounds, learning styles, interests..."></textarea>
                                </div>
                                <div class="solution-question">
                                    <label>What additional information should we collect?</label>
                                    <textarea class="solution-input" id="additional-info" placeholder="What other factors might predict student success?"></textarea>
                                </div>
                                <div class="solution-question">
                                    <label>How can we make sure the AI treats all students fairly?</label>
                                    <textarea class="solution-input" id="fairness-measures" placeholder="What rules or checks should we put in place?"></textarea>
                                </div>
                            </div>
                            <button class="detective-btn" onclick="completeDetective()">Complete Investigation 🎉</button>
                        </div>

                        <div class="detective-step" id="step5" style="display: none;">
                            <h4>🎉 Case Closed!</h4>
                            <div class="detective-summary">
                                <p><strong>Excellent detective work!</strong> You've identified key problems with AI training data:</p>
                                <ul>
                                    <li>✅ <strong>Bias Detection:</strong> Found stereotypes and missing perspectives</li>
                                    <li>✅ <strong>Data Quality:</strong> Identified insufficient sample size</li>
                                    <li>✅ <strong>Fairness Analysis:</strong> Recognized need for inclusive data</li>
                                    <li>✅ <strong>Solution Thinking:</strong> Proposed improvements for better AI</li>
                                </ul>
                                <p class="detective-lesson"><strong>Key Lesson:</strong> AI is only as good as its data. As future AI users, we must always ask: "Is this data fair, complete, and representative?"</p>
                                <button class="detective-btn" onclick="restartDetective()">🔄 Try Again</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            console.log('Data Detective HTML loaded, container content:', container.innerHTML.substring(0, 200) + '...');
            console.log('Container display style:', window.getComputedStyle(container).display);
            console.log('Container visibility:', window.getComputedStyle(container).visibility);
            console.log('Container position:', window.getComputedStyle(container).position);
            console.log('Container z-index:', window.getComputedStyle(container).zIndex);
            
            // Check parent element styling
            const parent = container.parentElement;
            console.log('Parent element styling:', {
                display: window.getComputedStyle(parent).display,
                visibility: window.getComputedStyle(parent).visibility,
                position: window.getComputedStyle(parent).position,
                zIndex: window.getComputedStyle(parent).zIndex,
                background: window.getComputedStyle(parent).backgroundColor
            });
            
            // Force visibility with inline styles as a test
            container.style.display = 'block';
            container.style.visibility = 'visible';
            container.style.position = 'relative';
            container.style.zIndex = '99999';
            container.style.background = 'yellow';
            container.style.border = '5px solid blue';
            container.style.minHeight = '500px';
            console.log('Forced container styling applied');
            
            // Initialize drag and drop
            initializeDetectiveDragDrop();
        }
        
        function loadExitPoll() {
            console.log('loadExitPoll called');
            
            // Create a working Exit Poll overlay that bypasses the broken activities container
            const exitPollOverlay = document.createElement('div');
            exitPollOverlay.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: white !important;
                z-index: 999999 !important;
                display: block !important;
                visibility: visible !important;
                overflow-y: auto !important;
                padding: 20px !important;
            `;
            exitPollOverlay.innerHTML = `
                <div class="activity-card" style="background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); padding: 30px; margin: 20px auto; max-width: 800px;">
                    <div class="activity-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 class="activity-title" style="color: #333; font-size: 24px; margin: 0;">Exit Poll 📝</h3>
                        <button onclick="window.location.href='index.html'" style="background: #6c757d; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">Back to Module</button>
                    </div>
                    <div class="reflection-section">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                            <p style="margin: 0; font-weight: 500; color: #333;"><strong>Reflection:</strong> Take a moment to think about what you've learned in this module. Your thoughtful responses help us understand your learning journey!</p>
                        </div>
                        
                        <div class="reflection-content">
                            <div class="reflection-questions">
                                <div class="reflection-question" style="margin-bottom: 30px;">
                                    <h4 style="color: #007cba; margin-bottom: 10px;">What is one thing you learned about how AI uses data?</h4>
                                    <textarea class="reflection-input" id="ai-data-learning" placeholder="Share your thoughts about how AI learns from data..." style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; min-height: 100px; font-family: inherit; resize: vertical; font-size: 14px;"></textarea>
                                </div>
                                
                                <div class="reflection-question" style="margin-bottom: 30px;">
                                    <h4 style="color: #007cba; margin-bottom: 10px;">Why do you think humans are important in designing AI?</h4>
                                    <textarea class="reflection-input" id="human-importance" placeholder="Explain why human involvement is crucial in AI development..." style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; min-height: 100px; font-family: inherit; resize: vertical; font-size: 14px;"></textarea>
                                </div>
                                
                                <div class="reflection-question" style="margin-bottom: 30px;">
                                    <h4 style="color: #007cba; margin-bottom: 10px;">How would you make sure an AI treats everyone fairly?</h4>
                                    <textarea class="reflection-input" id="ai-fairness" placeholder="Describe your ideas for ensuring AI fairness and equality..." style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; min-height: 100px; font-family: inherit; resize: vertical; font-size: 14px;"></textarea>
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 30px;">
                                <button onclick="submitExitPoll()" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; margin-right: 10px;">Submit Responses 🎉</button>
                                <button onclick="window.location.href='index.html'" style="background: #6c757d; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px;">Skip for Now</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(exitPollOverlay);
            console.log('Exit Poll overlay created successfully');
            
            // Add the submit function
            window.submitExitPoll = function() {
                console.log('Exit Poll submitted');
                
                // Mark Exit Poll as completed
                markActivityCompleted('exit-poll');
                
                // Collect responses
                const responses = {
                    aiDataLearning: exitPollOverlay.querySelector('#ai-data-learning').value,
                    humanImportance: exitPollOverlay.querySelector('#human-importance').value,
                    aiFairness: exitPollOverlay.querySelector('#ai-fairness').value,
                    submittedAt: new Date().toISOString()
                };
                
                // Save responses
                window.exitPollResponses = responses;
                console.log('Exit Poll responses saved:', responses);
                
                // Show thank you message
                exitPollOverlay.innerHTML = `
                    <div class="activity-card" style="background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); padding: 40px; margin: 20px auto; max-width: 600px; text-align: center;">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px;">
                            <h3 style="margin: 0 0 20px 0; font-size: 28px;">🙏 Thank You!</h3>
                            <p style="font-size: 18px; margin: 15px 0;">Your thoughtful responses have been recorded.</p>
                            <p style="font-size: 16px; margin: 20px 0;">Thank you for participating in this AI literacy journey!</p>
                            
                            <button onclick="continueFromExitPoll()" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 20px;">Continue →</button>
                        </div>
                    </div>
                `;
                
                // Add continue function
                window.continueFromExitPoll = function() {
                    exitPollOverlay.remove();
                    if (window.slideshowMode && window.nextSlide) {
                        const slideshowContainer = document.getElementById('slideshow-container');
                        if (slideshowContainer) {
                            slideshowContainer.style.display = 'block';
                        }
                        setTimeout(() => {
                            window.nextSlide();
                        }, 100);
                    } else if (window.backToModule) {
                        window.backToModule();
                    }
                };
            };
        }
        
        
        // DATA Quiz Functions
        function selectDataQuizAnswer(button, questionNum, isCorrect) {
            const questionDiv = button.closest('.quiz-question');
            const options = questionDiv.querySelectorAll('.quiz-option');
            const feedback = questionDiv.querySelector('.quiz-feedback');
            
            // Remove previous selections
            options.forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });
            
            // Mark selected answer
            button.classList.add('selected');
            
            if (isCorrect) {
                button.classList.add('correct');
                feedback.innerHTML = '<p class="correct-feedback">✓ Correct! Great job!</p>';
                feedback.style.display = 'block';
                
                // Track correct answer
                if (!window.dataQuizAnswers) {
                    window.dataQuizAnswers = {};
                }
                window.dataQuizAnswers[questionNum] = true;
                
                // Check if quiz is completed (all questions answered correctly)
                checkDataQuizCompletion();
                
            } else {
                button.classList.add('incorrect');
                // Show correct answer
                const correctButton = questionDiv.querySelector('[data-answer="correct"]');
                correctButton.classList.add('correct');
                feedback.innerHTML = '<p class="incorrect-feedback">✗ Not quite right. The correct answer is highlighted above.</p>';
                feedback.style.display = 'block';
                
                // Track incorrect answer
                if (!window.dataQuizAnswers) {
                    window.dataQuizAnswers = {};
                }
                window.dataQuizAnswers[questionNum] = false;
            }
        }
        
        function checkDataQuizCompletion() {
            // Currently there's only 1 question in loadQuizActivity, so completing it marks the quiz as done
            const totalQuestions = 1;
            const correctAnswers = Object.values(window.dataQuizAnswers || {}).filter(answer => answer === true).length;
            
            console.log(`Data Quiz Progress: ${correctAnswers}/${totalQuestions} correct answers`);
            
            if (correctAnswers >= totalQuestions) {
                console.log('🎯 Data Quiz completed! Marking quiz activity as completed.');
                markActivityCompleted('quiz');
                
                // Show completion message
                setTimeout(() => {
                    const container = document.querySelector('#activities .activities-container');
                    if (container) {
                        const completionDiv = document.createElement('div');
                        completionDiv.innerHTML = `
                            <div style="background: #d4edda; border: 2px solid #28a745; border-radius: 8px; padding: 20px; margin: 20px 0; text-align: center;">
                                <h3 style="color: #28a745; margin: 0 0 10px 0;">🎉 Quiz Complete!</h3>
                                <p style="margin: 0; color: #333;">Great job! You've successfully completed the Knowledge Check Quiz.</p>
                            </div>
                        `;
                        container.appendChild(completionDiv);
                        completionDiv.scrollIntoView({ behavior: 'smooth' });
                    }
                }, 1000);
            }
        }
        
        // Reflection Functions
        function submitReflections() {
            const inputs = document.querySelectorAll('.reflection-input');
            let allFilled = true;
            
            inputs.forEach(input => {
                if (input.value.trim() === '') {
                    allFilled = false;
                }
            });
            
            if (!allFilled) {
                alert('Please answer all reflection questions before submitting.');
                return;
            }
            
            // Collect responses
            const responses = Array.from(inputs).map(input => input.value.trim());
            
            // Show confirmation
            const container = document.querySelector('.reflection-questions');
            container.innerHTML = `
                <div class="reflection-complete">
                    <h3>🎉 Reflections Submitted!</h3>
                    <p>Thank you for sharing your thoughts about AI and data. Your reflections help us understand how you're learning and growing!</p>
                    <div class="reflection-summary">
                        <h4>Your Responses:</h4>
                        <div class="response-item">
                            <strong>What you learned about AI and data:</strong>
                            <p>"${responses[0]}"</p>
                        </div>
                        <div class="response-item">
                            <strong>Why humans are important in AI design:</strong>
                            <p>"${responses[1]}"</p>
                        </div>
                        <div class="response-item">
                            <strong>How to ensure AI fairness:</strong>
                            <p>"${responses[2]}"</p>
                        </div>
                    </div>
                    <button class="reflection-continue" onclick="continueToFinalAssessment()">Continue to Final Assessment</button>
                </div>
            `;
            
            // Save responses (in real implementation, this would go to a server)
            console.log('Reflection responses saved:', responses);
        }
        
        function continueToFinalAssessment() {
            // Scroll to final assessment
            const assessment = document.querySelector('.assessment-button-section');
            if (assessment) {
                assessment.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // Slideshow System
        window.slideshowMode = false;
        let currentSlideIndex = 0;
        let slideshowContent = [];
        
        function startUnit() {
            console.log('=== STARTING SLIDESHOW ===');
            window.slideshowMode = true;
            
            // Define the slideshow content order for Module 6
            slideshowContent = [
                { type: 'video', id: 'v1', title: 'How AI Learns and Solves Problems', description: 'Watch this video to understand how AI processes data and solves complex problems.' },
                { type: 'activity', id: 'vocab-bank', title: 'Vocabulary Bank', description: 'Learn essential AI and data science terminology.' },
                { type: 'activity', id: 'quiz', title: 'Knowledge Check Quiz', description: 'Test your understanding of AI learning concepts.' },
                { type: 'video', id: 'v2', title: 'How AI Learns and Helps Us', description: 'Explore how AI assists us in daily life and continues to learn.' },
                { type: 'activity', id: 'data-detective', title: 'Data Detective', description: 'Investigate and analyze data patterns like an AI detective.' },
                { type: 'activity', id: 'exit-poll', title: 'Exit Poll', description: 'Share your thoughts and feedback about this learning journey.' }
            ];
            
            console.log('Slideshow content:', slideshowContent);
            currentSlideIndex = 0;
            
            // Hide the hero container and regular module flow
            const heroContainer = document.querySelector('.module-hero-container');
            const moduleFlow = document.querySelector('.module-flow');
            
            if (heroContainer) {
                heroContainer.style.display = 'none';
                console.log('Hero container hidden');
            }
            
            if (moduleFlow) {
                moduleFlow.style.display = 'none';
                console.log('Module flow hidden');
            }
            
            // Create and show slideshow container
            createSlideshowContainer();
            
            // Wait a moment then show first slide
            setTimeout(() => {
                showSlide(0);
            }, 200);
        }
        
        function createSlideshowContainer() {
            console.log('Creating slideshow container...');
            
            // Remove existing slideshow if it exists
            const existingSlideshow = document.getElementById('slideshow-container');
            if (existingSlideshow) {
                existingSlideshow.remove();
            }
            
            const slideshowHTML = `
                <div id="slideshow-container" class="slideshow-container">
                    <div class="slideshow-header">
                        <div class="slideshow-progress">
                            <div class="progress-info">
                                <span class="slide-counter">
                                    <span id="current-slide-num">1</span> of <span id="total-slides">${slideshowContent.length}</span>
                                </span>
                                <span class="module-title">Module 6: Digital Citizenship</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="slideshow-progress-fill" style="width: ${(1/slideshowContent.length)*100}%"></div>
                            </div>
                        </div>
                        <button class="exit-slideshow-btn" onclick="exitSlideshow()" title="Exit Slideshow">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M15 5L5 15M5 5L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="slideshow-content" id="slideshow-content">
                        <!-- Slide content will be dynamically inserted here -->
                    </div>
                    
                    <div class="slideshow-navigation">
                        <button class="nav-btn prev-btn" id="prev-slide-btn" onclick="previousSlide()" disabled style="display: flex !important; visibility: visible !important;">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M12 5L7 10L12 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            Previous
                        </button>
                        
                        <div class="slide-indicators">
                            ${slideshowContent.map((_, index) => 
                                `<button class="slide-indicator ${index === 0 ? 'active' : ''}" onclick="goToSlide(${index})" data-slide="${index}"></button>`
                            ).join('')}
                        </div>
                        
                        <button class="nav-btn next-btn primary" id="next-slide-btn" onclick="nextSlide()" style="display: flex !important; visibility: visible !important;">
                            Next
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M8 5L13 10L8 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
            
            // Insert slideshow after module content
            const moduleContent = document.querySelector('.module-content');
            if (moduleContent) {
                moduleContent.insertAdjacentHTML('beforeend', slideshowHTML);
                console.log('Slideshow HTML inserted');
                
                // Verify the next button was created
                setTimeout(() => {
                    const nextBtn = document.getElementById('next-slide-btn');
                    console.log('Next button after creation:', nextBtn);
                    if (nextBtn) {
                        console.log('Next button classes:', nextBtn.className);
                        console.log('Next button style:', nextBtn.style.cssText);
                    }
                }, 100);
            } else {
                console.error('Module content container not found');
            }
        }
        
        function showSlide(index) {
            if (index < 0 || index >= slideshowContent.length) return;
            
            console.log(`Showing slide ${index + 1} of ${slideshowContent.length}`);
            
            currentSlideIndex = index;
            const slide = slideshowContent[index];
            const contentContainer = document.getElementById('slideshow-content');
            
            if (!contentContainer) {
                console.error('Slideshow content container not found');
                return;
            }
            
            // Create slide content based on type
            if (slide.type === 'video') {
                contentContainer.innerHTML = createVideoSlide(slide);
            } else if (slide.type === 'activity') {
                contentContainer.innerHTML = createActivitySlide(slide);
            }
            
            // Update progress indicators
            updateSlideshowProgress();
            
            // Update next button state based on current slide requirements
            updateNextButtonState();
            
            // Add fade-in animation
            contentContainer.style.opacity = '0';
            setTimeout(() => {
                contentContainer.style.opacity = '1';
            }, 100);
        }
        
        function createVideoSlide(slide) {
            let videoSrc = 'placeholder';
            if (slide.id === 'v1') {
                videoSrc = '../../../LineStyle Explainer Video Toolkit_1080p.mp4';
            } else if (slide.id === 'v2') {
                videoSrc = '../../../3D Explainer Video Toolkit_1080p.mp4';
            }
            
            return `
                <div class="slide-content video-slide">
                    <div class="slide-header">
                        <div class="slide-type-badge video-badge">📹 Video</div>
                        <h2 class="slide-title">${slide.title}</h2>
                        <p class="slide-description">${slide.description}</p>
                    </div>
                    
                    <div class="slide-media">
                        ${(slide.id === 'v1' || slide.id === 'v2') ? `
                            <div class="slideshow-video-player" onclick="playSlideshowVideo()">
                                <video id="slideshow-video" width="100%" height="400" controls style="display: none;">
                                    <source src="${videoSrc}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                                <div class="slideshow-play-btn" id="slideshow-play-btn">
                                    <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
                                        <circle cx="30" cy="30" r="30" fill="rgba(99, 102, 241, 0.9)"/>
                                        <path d="M23 18L41 30L23 42V18Z" fill="white"/>
                                    </svg>
                                </div>
                            </div>
                        ` : `
                            <div class="video-placeholder">
                                <div class="placeholder-icon">🎥</div>
                                <h4>${slide.title}</h4>
                                <p>Video content placeholder</p>
                            </div>
                        `}
                    </div>
                    
                    <!-- Navigation is handled by the main slideshow navigation buttons -->
                </div>
            `;
        }
        
        function createActivitySlide(slide) {
            return `
                <div class="slide-content activity-slide">
                    <div class="slide-header">
                        <div class="slide-type-badge activity-badge">🎯 Activity</div>
                        <h2 class="slide-title">${slide.title}</h2>
                        <p class="slide-description">${slide.description}</p>
                    </div>
                    
                    <div class="slide-media">
                        <div class="activity-preview">
                            <div class="activity-icon">
                                ${getActivityIcon(slide.id)}
                            </div>
                            <div class="activity-info">
                                <h4>Ready to start this activity?</h4>
                                <p>Click below to begin the interactive ${slide.title.toLowerCase()}.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="slide-actions">
                        <button class="slide-action-btn primary" onclick="startSlideshowActivity('${slide.id}')">
                            Start ${slide.title} →
                        </button>
                        <!-- Skip navigation removed - use main slideshow navigation instead -->
                    </div>
                </div>
            `;
        }
        
        function getActivityIcon(activityId) {
            const icons = {
                'vocab-bank': '📚',
                'quiz': '❓',
                'data-detective': '🔍',
                'exit-poll': '📊'
            };
            return icons[activityId] || '🎯';
        }
        
        function playSlideshowVideo() {
            const video = document.getElementById('slideshow-video');
            const playBtn = document.getElementById('slideshow-play-btn');
            
            if (video && playBtn) {
                video.style.display = 'block';
                playBtn.style.display = 'none';
                
                const playPromise = video.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        setTimeout(() => {
                            enterFullscreen(video);
                        }, 500);
                    }).catch(error => {
                        console.log('Slideshow video play failed:', error);
                    });
                }
                
                video.addEventListener('ended', function() {
                    playBtn.style.display = 'flex';
                    video.style.display = 'none';
                });
            }
        }
        
        function startSlideshowActivity(activityId) {
            // Hide slideshow temporarily and start activity
            const slideshowContainer = document.getElementById('slideshow-container');
            if (slideshowContainer) {
                slideshowContainer.style.display = 'none';
            }
            
            // Start the activity
            startActivity(activityId);
            
            // Override the back to module function to return to slideshow
            window.originalBackToModule = window.backToModule;
            window.backToModule = function() {
                const moduleFlow = document.querySelector('.module-flow');
                const activitiesContainer = document.getElementById('activities');
                const quizContainer = document.getElementById('quiz');
                
                moduleFlow.style.display = 'none';
                activitiesContainer.style.display = 'none';
                quizContainer.style.display = 'none';
                
                // Show slideshow again
                if (slideshowContainer) {
                    slideshowContainer.style.display = 'block';
                }
                
                // Restore original back function
                window.backToModule = window.originalBackToModule;
                
                // Optionally advance to next slide
                nextSlide();
            };
        }
        
        function nextSlide() {
            // Check if current slide is an activity that needs to be completed
            const currentSlide = slideshowContent[currentSlideIndex];
            
            if (currentSlide && currentSlide.type === 'activity') {
                const activityId = currentSlide.id;
                console.log(`Checking if activity '${activityId}' is completed...`);
                
                // Check if the current activity is completed
                if (!moduleActivities[activityId]) {
                    console.log(`Activity '${activityId}' not completed. Showing warning.`);
                    showActivityCompletionWarning(currentSlide.title);
                    return; // Don't advance to next slide
                } else {
                    console.log(`Activity '${activityId}' is completed. Proceeding to next slide.`);
                }
            }
            
            // Proceed to next slide if current slide is not an activity or activity is completed
            if (currentSlideIndex < slideshowContent.length - 1) {
                showSlide(currentSlideIndex + 1);
            } else {
                // End of slideshow
                completeSlideshowModule();
            }
        }
        
        function showActivityCompletionWarning(activityTitle) {
            // Create a warning overlay
            const warningOverlay = document.createElement('div');
            warningOverlay.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.8) !important;
                z-index: 1000000 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 2rem !important;
                box-sizing: border-box !important;
            `;
            
            warningOverlay.innerHTML = `
                <div style="
                    background: white !important;
                    border-radius: 1rem !important;
                    padding: 2rem !important;
                    max-width: 500px !important;
                    width: 100% !important;
                    text-align: center !important;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3) !important;
                ">
                    <div style="
                        width: 80px !important;
                        height: 80px !important;
                        background: #ffc107 !important;
                        border-radius: 50% !important;
                        margin: 0 auto 1.5rem auto !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        font-size: 2.5rem !important;
                    ">⚠️</div>
                    
                    <h2 style="
                        color: #dc3545 !important;
                        font-size: 1.5rem !important;
                        margin-bottom: 1rem !important;
                    ">Activity Required</h2>
                    
                    <p style="
                        color: #6c757d !important;
                        font-size: 1.1rem !important;
                        margin-bottom: 1.5rem !important;
                        line-height: 1.5 !important;
                    ">You must complete "<strong>${activityTitle}</strong>" before proceeding to the next slide.</p>
                    
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: #007cba !important;
                        color: white !important;
                        border: none !important;
                        padding: 0.75rem 2rem !important;
                        border-radius: 0.5rem !important;
                        font-size: 1rem !important;
                        font-weight: 600 !important;
                        cursor: pointer !important;
                        transition: all 0.3s ease !important;
                    " onmouseover="this.style.background='#0056b3'" onmouseout="this.style.background='#007cba'">
                        OK, I'll Complete It
                    </button>
                </div>
            `;
            
            document.body.appendChild(warningOverlay);
        }
        
        function updateNextButtonState() {
            const nextBtn = document.getElementById('next-slide-btn');
            const currentSlide = slideshowContent[currentSlideIndex];
            
            if (nextBtn && currentSlide && currentSlide.type === 'activity') {
                const activityId = currentSlide.id;
                const isCompleted = moduleActivities[activityId];
                
                if (isCompleted) {
                    // Activity completed - enable button
                    nextBtn.style.opacity = '1';
                    nextBtn.style.cursor = 'pointer';
                    nextBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    nextBtn.title = 'Proceed to next slide';
                } else {
                    // Activity not completed - show visual indication
                    nextBtn.style.opacity = '0.6';
                    nextBtn.style.cursor = 'not-allowed';
                    nextBtn.style.background = '#6c757d';
                    nextBtn.title = `Complete "${currentSlide.title}" to continue`;
                }
            } else if (nextBtn) {
                // Not an activity slide - normal button state
                nextBtn.style.opacity = '1';
                nextBtn.style.cursor = 'pointer';
                nextBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                nextBtn.title = 'Proceed to next slide';
            }
        }
        
        function previousSlide() {
            if (currentSlideIndex > 0) {
                showSlide(currentSlideIndex - 1);
            }
        }
        
        function goToSlide(index) {
            showSlide(index);
        }
        
        function updateSlideshowProgress() {
            console.log(`Updating slideshow progress for slide ${currentSlideIndex + 1}`);
            
            // Update progress bar
            const progressFill = document.getElementById('slideshow-progress-fill');
            if (progressFill) {
                const progressPercent = ((currentSlideIndex + 1) / slideshowContent.length) * 100;
                progressFill.style.width = `${progressPercent}%`;
            }
            
            // Update slide counter
            const currentSlideNum = document.getElementById('current-slide-num');
            if (currentSlideNum) {
                currentSlideNum.textContent = currentSlideIndex + 1;
            }
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prev-slide-btn');
            const nextBtn = document.getElementById('next-slide-btn');
            
            console.log('Previous button found:', !!prevBtn);
            console.log('Next button found:', !!nextBtn);
            
            if (prevBtn) {
                prevBtn.disabled = currentSlideIndex === 0;
            }
            
            if (nextBtn) {
                // Ensure button is visible
                nextBtn.style.display = 'flex';
                nextBtn.style.visibility = 'visible';
                
                console.log(`Next button - current slide: ${currentSlideIndex}, total slides: ${slideshowContent.length}`);
                
                if (currentSlideIndex === slideshowContent.length - 1) {
                    nextBtn.innerHTML = `
                        Complete Module
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M16 10L12 6M16 10L12 14M16 10H4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    `;
                    console.log('Set next button to "Complete Module"');
                } else {
                    nextBtn.innerHTML = `
                        Next
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M8 5L13 10L8 15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    `;
                    console.log('Set next button to "Next"');
                }
                
                // Ensure CSS classes are maintained
                if (!nextBtn.classList.contains('nav-btn')) {
                    nextBtn.classList.add('nav-btn', 'next-btn', 'primary');
                }
            } else {
                console.error('Next button not found in DOM');
            }
            
            // Update slide indicators
            document.querySelectorAll('.slide-indicator').forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentSlideIndex);
            });
        }
        
        function completeSlideshowModule() {
            console.log('Completing slideshow module');
            
            // Create a completion overlay
            const completionOverlay = document.createElement('div');
            completionOverlay.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: white !important;
                z-index: 1000000 !important;
                display: flex !important;
                align-items: flex-start !important;
                justify-content: center !important;
                overflow-y: auto !important;
                padding: 40px 20px !important;
                box-sizing: border-box !important;
                color: #333 !important;
                font-family: 'Inter', system-ui, -apple-system, sans-serif !important;
            `;
            
            completionOverlay.innerHTML = `
                <div style="text-align: center; max-width: 700px; width: 100%; padding: 60px 40px; background: white; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05); margin: 20px 0; min-height: fit-content;">
                    <!-- Success Icon -->
                    <div style="width: 120px; height: 120px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 32px auto; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);">
                        <svg width="60" height="60" viewBox="0 0 24 24" fill="none" style="color: white;">
                            <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    
                    <!-- Title -->
                    <h1 style="font-size: 42px; font-weight: 800; margin: 0 0 16px 0; color: #111827; letter-spacing: -0.02em;">Congratulations!</h1>
                    <p style="font-size: 20px; color: #6b7280; margin: 0 0 12px 0; font-weight: 500;">You have successfully completed</p>
                    <h2 style="font-size: 24px; font-weight: 700; color: #10b981; margin: 0 0 40px 0;">Module 6: Digital Citizenship and Future Technologies</h2>
                    
                    <!-- Accomplishments Card -->
                    <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 16px; padding: 32px; margin: 40px 0; text-align: left;">
                        <h3 style="font-size: 20px; font-weight: 700; color: #374151; margin: 0 0 24px 0; text-align: center;">🎯 What You've Accomplished</h3>
                        <div style="display: grid; gap: 16px;">
                            <div style="display: flex; align-items: center; padding: 12px 16px; background: white; border-radius: 12px; border: 1px solid #e5e7eb;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 16px;">
                                    <span style="font-size: 18px;">📹</span>
                                </div>
                                <span style="font-size: 16px; font-weight: 500; color: #374151;">Watched AI learning videos</span>
                            </div>
                            <div style="display: flex; align-items: center; padding: 12px 16px; background: white; border-radius: 12px; border: 1px solid #e5e7eb;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 16px;">
                                    <span style="font-size: 18px;">📚</span>
                                </div>
                                <span style="font-size: 16px; font-weight: 500; color: #374151;">Explored the vocabulary bank</span>
                            </div>
                            <div style="display: flex; align-items: center; padding: 12px 16px; background: white; border-radius: 12px; border: 1px solid #e5e7eb;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 16px;">
                                    <span style="font-size: 18px;">📝</span>
                                </div>
                                <span style="font-size: 16px; font-weight: 500; color: #374151;">Completed the knowledge quiz</span>
                            </div>
                            <div style="display: flex; align-items: center; padding: 12px 16px; background: white; border-radius: 12px; border: 1px solid #e5e7eb;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 16px;">
                                    <span style="font-size: 18px;">🔍</span>
                                </div>
                                <span style="font-size: 16px; font-weight: 500; color: #374151;">Investigated data bias as a Data Detective</span>
                            </div>
                            <div style="display: flex; align-items: center; padding: 12px 16px; background: white; border-radius: 12px; border: 1px solid #e5e7eb;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #06b6d4, #0891b2); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 16px;">
                                    <span style="font-size: 18px;">💭</span>
                                </div>
                                <span style="font-size: 16px; font-weight: 500; color: #374151;">Reflected on AI's role in society</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Success Message -->
                    <p style="font-size: 18px; color: #6b7280; line-height: 1.6; margin: 32px 0 48px 0;">You're now equipped with essential knowledge about AI, data ethics, and digital citizenship!</p>
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="goHome()" 
                                style="background: linear-gradient(135deg, #10b981, #059669); 
                                       color: white; 
                                       border: none; 
                                       padding: 16px 32px; 
                                       border-radius: 12px; 
                                       cursor: pointer; 
                                       font-weight: 600; 
                                       font-size: 16px; 
                                       display: flex; 
                                       align-items: center; 
                                       gap: 8px;
                                       box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3); 
                                       transition: all 0.2s ease;
                                       min-width: 140px;
                                       justify-content: center;" 
                                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 24px rgba(16, 185, 129, 0.4)'" 
                                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 16px rgba(16, 185, 129, 0.3)'">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="color: white;">
                                <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Go Home
                        </button>
                        
                        <button onclick="restartModule()" 
                                style="background: white; 
                                       color: #374151; 
                                       border: 2px solid #e5e7eb; 
                                       padding: 16px 32px; 
                                       border-radius: 12px; 
                                       cursor: pointer; 
                                       font-weight: 600; 
                                       font-size: 16px; 
                                       display: flex; 
                                       align-items: center; 
                                       gap: 8px;
                                       transition: all 0.2s ease;
                                       min-width: 140px;
                                       justify-content: center;" 
                                onmouseover="this.style.borderColor='#d1d5db'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.1)'" 
                                onmouseout="this.style.borderColor='#e5e7eb'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="color: currentColor;">
                                <path d="M1 4V10H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M3.51 15C4.54 17.47 6.92 19.42 9.74 20.23C12.56 21.04 15.64 20.64 18.12 19.12C20.6 17.6 22.25 15.09 22.68 12.23C23.11 9.37 22.29 6.47 20.4 4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Restart Module
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(completionOverlay);
            
            // Add the navigation functions
            window.goHome = function() {
                console.log('Going to module home page');
                // Navigate to the module home page
                window.location.href = 'index.html';
            };
            
            window.restartModule = function() {
                console.log('Restarting module and resetting progress');
                // Reset all progress and localStorage
                resetModuleProgress();
                // Remove the overlay and restart the slideshow
                completionOverlay.remove();
                // Reset and start fresh
                window.slideshowMode = false;
                currentSlideIndex = 0;
                exitSlideshow();
                // Restart the slideshow
                setTimeout(() => {
                    startUnit();
                }, 500);
            };
        }
        
        function exitSlideshow() {
            console.log('Exiting slideshow - redirecting to module home page');
            
            // Instead of trying to restore the complex slideshow state,
            // just redirect to the module home page for a clean experience
            window.location.href = 'index.html';
        }

        // Navigate to activity page or start activity inline
        function openActivityWindow(activityId) {
            console.log('openActivityWindow called with:', activityId);
            if (activityId === 'vocab-bank') {
                startActivity('vocab-bank');
            } else if (activityId === 'quiz') {
                startActivity('quiz');
            } else if (activityId === 'data-detective') {
                startActivity(activityId);
            } else if (activityId === 'exit-poll') {
                startActivity('exit-poll');
            } else if (activityId === 'assessment') {
                startAssessment();
            }
        }
        
        // Add styles for Module 6
        const style = document.createElement('style');
        style.textContent = `
            /* Module Hero Container Styles */
            .module-hero-container {
                position: relative;
                width: 100%;
                height: 400px;
                background: var(--light-bg);
                border-radius: 1rem;
                margin-bottom: 2rem;
                overflow: hidden;
                box-shadow: var(--shadow-lg);
            }
            
            .module-hero-image {
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .image-placeholder {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 1rem;
                color: var(--text-secondary);
            }
            
            .placeholder-text {
                font-size: 1.125rem;
                font-weight: 500;
                color: var(--text-secondary);
                margin: 0;
            }
            
            .module-title-overlay {
                position: absolute;
                top: 2rem;
                left: 2rem;
                right: 2rem;
                z-index: 10;
            }
            
            .back-btn-overlay {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.5rem 1rem;
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(8px);
                border: none;
                border-radius: 0.5rem;
                color: var(--text-primary);
                cursor: pointer;
                transition: all 0.3s ease;
                margin-bottom: 1rem;
                font-weight: 500;
            }
            
            .back-btn-overlay:hover {
                background: rgba(255, 255, 255, 1);
                transform: translateY(-2px);
                box-shadow: var(--shadow-md);
            }
            
            .module-meta-overlay {
                display: flex;
                gap: 1rem;
                margin-bottom: 0.5rem;
            }
            
            .module-number {
                font-size: 0.875rem;
                font-weight: 600;
                color: var(--primary-color);
                text-transform: uppercase;
            }
            
            .module-duration {
                font-size: 0.875rem;
                color: var(--text-secondary);
            }
            
            .module-title-main {
                font-size: 2.5rem;
                font-weight: 700;
                color: var(--text-primary);
                margin: 0 0 0.5rem 0;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            
            .module-description-overlay {
                font-size: 1.125rem;
                color: var(--text-secondary);
                margin: 0;
                max-width: 600px;
                line-height: 1.6;
            }
            
            .module-progress-overlay {
                position: absolute;
                bottom: 2rem;
                left: 2rem;
                right: 2rem;
                z-index: 10;
            }
            
            .progress-info-overlay {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.5rem;
            }
            
            .progress-text-overlay {
                font-size: 0.875rem;
                font-weight: 600;
                color: var(--text-primary);
            }
            
            .progress-bar-overlay {
                width: 100%;
                height: 8px;
                background: rgba(255, 255, 255, 0.3);
                border-radius: 4px;
                overflow: hidden;
                backdrop-filter: blur(8px);
            }
            
            .progress-fill-overlay {
                height: 100%;
                background: var(--gradient-primary);
                transition: width 0.3s ease;
                border-radius: 4px;
            }
            
            .start-unit-container {
                position: absolute;
                bottom: 2rem;
                right: 2rem;
                z-index: 10;
            }
            
            .start-unit-btn {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                padding: 1rem 2rem;
                background: var(--gradient-primary);
                color: white;
                border: none;
                border-radius: 0.75rem;
                font-size: 1.125rem;
                font-weight: 700;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: var(--shadow-lg);
            }
            
            .start-unit-btn:hover {
                transform: translateY(-3px);
                box-shadow: 0 15px 25px -3px rgba(0, 0, 0, 0.15);
            }
            
            .start-unit-btn:active {
                transform: translateY(-1px);
            }
            
            /* Video Player Styles */
            .video-player {
                position: relative;
                background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #06b6d4 100%);
                border-radius: 0.75rem;
                overflow: hidden;
                cursor: pointer;
                min-height: 300px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                box-shadow: var(--shadow-lg);
            }
            
            .video-player:hover {
                transform: translateY(-2px);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            
            .video-player::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.3);
                z-index: 1;
            }
            
            .video-player video {
                width: 100%;
                height: auto;
                border-radius: 0.75rem;
                background: #000;
                z-index: 3;
            }
            
            .play-btn {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(255, 255, 255, 0.9);
                border-radius: 50%;
                width: 80px;
                height: 80px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--primary-color);
                transition: all 0.3s ease;
                z-index: 2;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            }
            
            .play-btn:hover {
                background: rgba(255, 255, 255, 1);
                transform: translate(-50%, -50%) scale(1.15);
                box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
            }
            
            .play-btn svg {
                width: 35px;
                height: 35px;
                margin-left: 4px; /* Slight offset to center the play triangle */
            }
            
            /* Fullscreen video styles */
            .video-player video:fullscreen {
                object-fit: contain;
                background: #000;
                border-radius: 0;
            }
            
            .video-player video:-webkit-full-screen {
                object-fit: contain;
                background: #000;
                border-radius: 0;
            }
            
            .video-player video::-webkit-media-controls {
                background: rgba(0, 0, 0, 0.8);
            }
            
            /* Add a fullscreen icon overlay */
            .video-player::after {
                content: '⛶';
                position: absolute;
                top: 1rem;
                right: 1rem;
                color: rgba(255, 255, 255, 0.7);
                font-size: 1.5rem;
                z-index: 2;
                transition: all 0.3s ease;
            }
            
            .video-player:hover::after {
                color: rgba(255, 255, 255, 1);
                transform: scale(1.1);
            }
            
            /* Module 6 Specific Styles */
            .vocabulary-section {
                background: var(--card-bg);
                border-radius: 1rem;
                padding: 2rem;
                margin: 2rem 0;
                box-shadow: var(--shadow-md);
            }
            
            .vocabulary-section h3 {
                color: var(--primary-color);
                margin-bottom: 1.5rem;
                text-align: center;
                font-size: 1.5rem;
            }
            
            .vocabulary-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1rem;
                margin-top: 1.5rem;
            }
            
            .vocab-card {
                background: var(--light-bg);
                border-radius: 0.75rem;
                padding: 1.5rem;
                transition: transform 0.3s ease, box-shadow 0.3s ease;
                border: 2px solid transparent;
            }
            
            .vocab-card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow-md);
                border-color: var(--primary-color);
            }
            
            .vocab-card h4 {
                color: var(--primary-color);
                font-size: 1.1rem;
                margin-bottom: 0.75rem;
                font-weight: 600;
            }
            
            .vocab-card p {
                color: var(--text-secondary);
                line-height: 1.5;
                margin: 0;
                font-size: 0.95rem;
            }
            
            .reflection-section, .reading-section, .quiz-section {
                background: var(--card-bg);
                border-radius: 1rem;
                padding: 2rem;
                margin: 2rem 0;
                box-shadow: var(--shadow-md);
            }
            
            .reflection-section h3 {
                color: var(--primary-color);
                margin-bottom: 1.5rem;
                text-align: center;
                font-size: 1.5rem;
            }
            
            .journey-highlights {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 1rem;
                margin: 2rem 0;
            }
            
            .highlight-card {
                background: var(--light-bg);
                border-radius: 0.75rem;
                padding: 1.5rem;
                text-align: center;
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            
            .highlight-card:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow-md);
            }
            
            .highlight-icon {
                font-size: 2.5rem;
                margin-bottom: 1rem;
            }
            
            .highlight-card h5 {
                color: var(--primary-color);
                font-size: 1rem;
                margin-bottom: 0.5rem;
                font-weight: 600;
            }
            
            .highlight-card p {
                color: var(--text-secondary);
                line-height: 1.4;
                margin: 0;
                font-size: 0.9rem;
            }
            
            .final-certificate-container {
                text-align: center;
                padding: 2rem;
            }
            
            .final-certificate {
                background: linear-gradient(135deg, #6366f1 0%, #a855f7 50%, #ec4899 100%);
                color: white;
                padding: 3rem 2rem;
                border-radius: 1rem;
                margin: 2rem auto;
                max-width: 600px;
                box-shadow: var(--shadow-lg);
                position: relative;
                overflow: hidden;
            }
            
            .final-certificate::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="20" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="20" cy="90" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
                pointer-events: none;
            }
            
            .final-certificate h2 {
                font-size: 2.5rem;
                margin-bottom: 1rem;
                position: relative;
                z-index: 1;
            }
            
            .final-certificate h3 {
                font-size: 1.8rem;
                margin-bottom: 0.5rem;
                position: relative;
                z-index: 1;
            }
            
            .final-certificate h4 {
                font-size: 1.4rem;
                margin: 1rem 0;
                position: relative;
                z-index: 1;
            }
            
            .certificate-badge {
                margin: 2rem 0;
                position: relative;
                z-index: 1;
            }
            
            .completion-message {
                font-size: 1.2rem;
                font-weight: 600;
                margin: 1.5rem 0;
                position: relative;
                z-index: 1;
            }
            
            .skills-earned {
                margin-top: 2rem;
                position: relative;
                z-index: 1;
            }
            
            .skills-earned h5 {
                font-size: 1.1rem;
                margin-bottom: 1rem;
            }
            
            .skills-list {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                justify-content: center;
            }
            
            .skill-badge {
                background: rgba(255, 255, 255, 0.2);
                padding: 0.5rem 1rem;
                border-radius: 2rem;
                font-size: 0.85rem;
                font-weight: 500;
                backdrop-filter: blur(8px);
            }
            
            .blank-activity {
                text-align: center;
                padding: 3rem 2rem;
                background: var(--light-bg);
                border-radius: 1rem;
                margin: 1rem 0;
            }
            
            .blank-icon {
                font-size: 4rem;
                margin-bottom: 1rem;
            }
            
            .blank-activity h4 {
                color: var(--primary-color);
                margin-bottom: 1rem;
            }
            
            .blank-activity ul {
                text-align: left;
                max-width: 400px;
                margin: 1rem auto;
            }
            
            .placeholder-note {
                background: rgba(99, 102, 241, 0.1);
                color: var(--primary-color);
                padding: 1rem;
                border-radius: 0.5rem;
                margin-top: 1.5rem;
                font-weight: 600;
            }
            
            .activities-container {
                padding: 2rem;
                min-height: 400px;
            }
            
            .activity-card {
                background: var(--card-bg);
                border-radius: 1rem;
                padding: 2rem;
                box-shadow: var(--shadow-md);
                width: 100%;
                max-width: 800px;
                margin: 0 auto;
            }
            
            .activity-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.5rem;
            }
            
            .back-to-module-btn {
                background: var(--text-secondary);
                color: white;
                border: none;
                padding: 0.5rem 1rem;
                border-radius: 0.5rem;
                cursor: pointer;
                font-size: 0.875rem;
            }
            
            /* DATA Unit Specific Styles */
            .reading-section h3, .quiz-section h3 {
                color: var(--primary-color);
                margin-bottom: 1.5rem;
                text-align: center;
                font-size: 1.5rem;
            }
            
            .reading-content p {
                color: var(--text-secondary);
                line-height: 1.6;
                margin-bottom: 1rem;
                font-size: 1rem;
            }
            
            .data-quiz-container {
                max-width: 800px;
                margin: 0 auto;
            }
            
            .quiz-question {
                background: var(--light-bg);
                border-radius: 0.75rem;
                padding: 1.5rem;
                margin-bottom: 2rem;
                border: 2px solid transparent;
                transition: border-color 0.3s ease;
            }
            
            .quiz-question h4 {
                color: var(--text-primary);
                margin-bottom: 1rem;
                font-size: 1.1rem;
                font-weight: 600;
            }
            
            .quiz-options {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .quiz-option {
                background: white;
                border: 2px solid var(--border-color);
                border-radius: 0.5rem;
                padding: 1rem;
                text-align: left;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 0.95rem;
                color: var(--text-primary);
            }
            
            .quiz-option:hover {
                border-color: var(--primary-color);
                background: rgba(99, 102, 241, 0.05);
            }
            
            .quiz-option.selected {
                border-color: var(--primary-color);
                background: rgba(99, 102, 241, 0.1);
            }
            
            .quiz-option.correct {
                border-color: #10b981;
                background: rgba(16, 185, 129, 0.1);
                color: #10b981;
            }
            
            .quiz-option.incorrect {
                border-color: #ef4444;
                background: rgba(239, 68, 68, 0.1);
                color: #ef4444;
            }
            
            .quiz-feedback {
                margin-top: 1rem;
                padding: 1rem;
                border-radius: 0.5rem;
            }
            
            .correct-feedback {
                background: rgba(16, 185, 129, 0.1);
                color: #10b981;
                margin: 0;
                font-weight: 600;
            }
            
            .incorrect-feedback {
                background: rgba(239, 68, 68, 0.1);
                color: #ef4444;
                margin: 0;
                font-weight: 600;
            }
            
            /* Data Detective Styles */
            .data-detective-game {
                max-width: 900px;
                margin: 0 auto;
            }
            
            .detective-intro {
                background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                color: white;
                padding: 1.5rem;
                border-radius: 0.75rem;
                margin-bottom: 2rem;
                text-align: center;
                font-size: 1.1rem;
            }
            
            .detective-step {
                background: var(--light-bg);
                border-radius: 0.75rem;
                padding: 2rem;
                margin-bottom: 2rem;
            }
            
            .detective-step h4 {
                color: var(--primary-color);
                margin-bottom: 1rem;
                font-size: 1.3rem;
                font-weight: 600;
            }
            
            .student-data {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 1rem;
                margin: 1.5rem 0;
            }
            
            .student-card {
                background: white;
                border: 2px solid #e5e7eb;
                border-radius: 0.5rem;
                padding: 1rem;
                cursor: grab;
                transition: all 0.3s ease;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .student-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0,0,0,0.15);
                border-color: var(--primary-color);
            }
            
            .student-card:active {
                cursor: grabbing;
            }
            
            .student-info {
                font-size: 0.95rem;
                color: var(--text-primary);
                line-height: 1.4;
            }
            
            .sorting-area {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 1.5rem;
                margin: 2rem 0;
            }
            
            .sort-group {
                background: white;
                border: 2px solid #e5e7eb;
                border-radius: 0.75rem;
                padding: 1rem;
            }
            
            .group-header {
                margin-bottom: 1rem;
            }
            
            .group-label {
                width: 100%;
                padding: 0.75rem;
                border: 2px solid #d1d5db;
                border-radius: 0.5rem;
                font-size: 1rem;
                font-weight: 600;
                color: var(--text-primary);
            }
            
            .group-label:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }
            
            .group-dropzone {
                min-height: 120px;
                border: 2px dashed #d1d5db;
                border-radius: 0.5rem;
                background: #f9fafb;
                display: flex;
                align-items: center;
                justify-content: center;
                text-align: center;
                color: #6b7280;
                font-weight: 500;
                transition: all 0.3s ease;
                flex-wrap: wrap;
                padding: 0.5rem;
                gap: 0.5rem;
            }
            
            .group-dropzone:hover {
                border-color: var(--primary-color);
                background: rgba(59, 130, 246, 0.05);
            }
            
            .problem-checklist {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin: 1.5rem 0;
            }
            
            .problem-checklist label {
                display: flex;
                align-items: flex-start;
                gap: 0.75rem;
                padding: 1rem;
                background: white;
                border: 2px solid #e5e7eb;
                border-radius: 0.5rem;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .problem-checklist label:hover {
                border-color: var(--primary-color);
                background: rgba(59, 130, 246, 0.05);
            }
            
            .problem-check {
                margin: 0;
                transform: scale(1.2);
            }
            
            .solution-form {
                margin: 1.5rem 0;
            }
            
            .solution-question {
                margin-bottom: 2rem;
            }
            
            .solution-question label {
                display: block;
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 0.75rem;
                font-size: 1.1rem;
            }
            
            .solution-input {
                width: 100%;
                min-height: 100px;
                padding: 1rem;
                border: 2px solid #d1d5db;
                border-radius: 0.5rem;
                font-family: inherit;
                font-size: 1rem;
                line-height: 1.5;
                resize: vertical;
            }
            
            .solution-input:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }
            
            .detective-btn {
                background: var(--gradient-primary);
                color: white;
                border: none;
                padding: 1rem 2rem;
                border-radius: 0.75rem;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                margin: 1rem 0;
            }
            
            .detective-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            }
            
            .detective-summary {
                background: white;
                padding: 2rem;
                border-radius: 0.75rem;
                border: 2px solid #10b981;
            }
            
            .detective-summary ul {
                margin: 1.5rem 0;
                padding-left: 0;
                list-style: none;
            }
            
            .detective-summary li {
                padding: 0.75rem 0;
                border-bottom: 1px solid #e5e7eb;
            }
            
            .detective-summary li:last-child {
                border-bottom: none;
            }
            
            .detective-lesson {
                background: rgba(16, 185, 129, 0.1);
                padding: 1.5rem;
                border-radius: 0.5rem;
                border-left: 4px solid #10b981;
                margin: 1.5rem 0;
                font-style: italic;
            }
            
            @media (max-width: 768px) {
                .student-data {
                    grid-template-columns: 1fr;
                }
                
                .sorting-area {
                    grid-template-columns: 1fr;
                }
                
                .detective-step {
                    padding: 1.5rem;
                }
            }
            
            .reflection-questions {
                max-width: 800px;
                margin: 0 auto;
            }
            
            .reflection-question {
                background: var(--light-bg);
                border-radius: 0.75rem;
                padding: 1.5rem;
                margin-bottom: 1.5rem;
            }
            
            .reflection-question h4 {
                color: var(--primary-color);
                margin-bottom: 1rem;
                font-size: 1.1rem;
                font-weight: 600;
            }
            
            .reflection-input {
                width: 100%;
                min-height: 100px;
                padding: 1rem;
                border: 2px solid var(--border-color);
                border-radius: 0.5rem;
                font-family: inherit;
                font-size: 0.95rem;
                color: var(--text-primary);
                background: white;
                resize: vertical;
                transition: border-color 0.3s ease;
            }
            
            .reflection-input:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            }
            
            .reflection-submit {
                background: var(--gradient-primary);
                color: white;
                border: none;
                padding: 1rem 2rem;
                border-radius: 0.75rem;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                display: block;
                margin: 2rem auto 0;
                box-shadow: var(--shadow-md);
            }
            
            .reflection-submit:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
            }
            
            .reflection-complete {
                text-align: center;
                padding: 2rem;
                background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%);
                border-radius: 1rem;
                margin: 2rem 0;
            }
            
            .reflection-complete h3 {
                color: var(--primary-color);
                margin-bottom: 1rem;
                font-size: 1.5rem;
            }
            
            .reflection-summary {
                text-align: left;
                max-width: 600px;
                margin: 2rem auto;
                background: white;
                padding: 1.5rem;
                border-radius: 0.75rem;
                box-shadow: var(--shadow-sm);
            }
            
            .response-item {
                margin-bottom: 1.5rem;
                padding-bottom: 1rem;
                border-bottom: 1px solid var(--border-color);
            }
            
            .response-item:last-child {
                border-bottom: none;
                margin-bottom: 0;
            }
            
            .response-item strong {
                color: var(--primary-color);
                display: block;
                margin-bottom: 0.5rem;
                font-size: 0.95rem;
            }
            
            .response-item p {
                color: var(--text-secondary);
                font-style: italic;
                margin: 0;
                padding: 0.5rem;
                background: var(--light-bg);
                border-radius: 0.5rem;
                border-left: 3px solid var(--primary-color);
            }
            
            .reflection-continue {
                background: var(--gradient-primary);
                color: white;
                border: none;
                padding: 1rem 2rem;
                border-radius: 0.75rem;
                font-size: 1rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-top: 1.5rem;
            }
            
            .detective-instructions {
                background: var(--light-bg);
                padding: 1.5rem;
                border-radius: 0.75rem;
                margin: 1rem 0;
                border-left: 4px solid var(--primary-color);
            }
            
            .detective-instructions ol {
                margin: 0;
                padding-left: 1.5rem;
            }
            
            .detective-instructions li {
                margin-bottom: 0.5rem;
                color: var(--text-secondary);
                line-height: 1.5;
            }
            
            /* Slideshow Styles */
            .slideshow-container {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: var(--card-bg);
                z-index: 1000;
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }
            
            .slideshow-header {
                background: white;
                padding: 1.5rem 2rem;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            }
            
            .slideshow-progress {
                flex: 1;
            }
            
            .progress-info {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.5rem;
            }
            
            .slide-counter {
                font-size: 0.875rem;
                color: var(--text-secondary);
                font-weight: 600;
            }
            
            .module-title {
                font-size: 0.875rem;
                color: var(--primary-color);
                font-weight: 600;
            }
            
            .progress-bar {
                width: 100%;
                height: 6px;
                background: var(--border-color);
                border-radius: 3px;
                overflow: hidden;
            }
            
            .progress-fill {
                height: 100%;
                background: var(--gradient-primary);
                transition: width 0.3s ease;
            }
            
            .exit-slideshow-btn {
                background: var(--light-bg);
                border: 1px solid var(--border-color);
                border-radius: 0.5rem;
                padding: 0.75rem;
                cursor: pointer;
                color: var(--text-secondary);
                transition: all 0.3s ease;
                margin-left: 2rem;
            }
            
            .exit-slideshow-btn:hover {
                background: var(--danger-color);
                color: white;
                border-color: var(--danger-color);
            }
            
            .slideshow-content {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 2rem 2rem 8rem 2rem;
                transition: opacity 0.3s ease;
                overflow-y: auto;
            }
            
            .slide-content {
                max-width: 900px;
                width: 100%;
                text-align: center;
            }
            
            .slide-header {
                margin-bottom: 2rem;
            }
            
            .slide-type-badge {
                display: inline-block;
                padding: 0.5rem 1rem;
                border-radius: 2rem;
                font-size: 0.875rem;
                font-weight: 600;
                margin-bottom: 1rem;
            }
            
            .video-badge {
                background: rgba(59, 130, 246, 0.1);
                color: var(--primary-color);
            }
            
            .activity-badge {
                background: rgba(16, 185, 129, 0.1);
                color: #10b981;
            }
            
            .slide-title {
                font-size: 2.5rem;
                font-weight: 700;
                color: var(--text-primary);
                margin-bottom: 1rem;
                line-height: 1.2;
            }
            
            .slide-description {
                font-size: 1.25rem;
                color: var(--text-secondary);
                line-height: 1.6;
                max-width: 700px;
                margin: 0 auto;
            }
            
            .slide-media {
                margin: 3rem 0;
            }
            
            .slideshow-video-player {
                position: relative;
                background: #000;
                border-radius: 1rem;
                overflow: hidden;
                cursor: pointer;
                min-height: 400px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: var(--shadow-lg);
            }
            
            .slideshow-play-btn {
                transition: all 0.3s ease;
            }
            
            .slideshow-play-btn:hover {
                transform: scale(1.1);
            }
            
            .video-placeholder {
                background: var(--light-bg);
                border-radius: 1rem;
                padding: 4rem 2rem;
                border: 2px dashed var(--border-color);
            }
            
            .placeholder-icon {
                font-size: 4rem;
                margin-bottom: 1rem;
            }
            
            .activity-preview {
                background: var(--light-bg);
                border-radius: 1rem;
                padding: 3rem 2rem;
                display: flex;
                align-items: center;
                gap: 2rem;
                max-width: 600px;
                margin: 0 auto;
            }
            
            .activity-icon {
                font-size: 4rem;
                background: white;
                border-radius: 50%;
                width: 100px;
                height: 100px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: var(--shadow-md);
            }
            
            .activity-info {
                text-align: left;
            }
            
            .activity-info h4 {
                color: var(--text-primary);
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .slide-actions {
                display: flex;
                gap: 1rem;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .slide-action-btn {
                padding: 1rem 2rem;
                border: none;
                border-radius: 0.75rem;
                font-size: 1.125rem;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                min-width: 200px;
            }
            
            .slide-action-btn.primary {
                background: var(--gradient-primary);
                color: white;
                box-shadow: var(--shadow-md);
            }
            
            .slide-action-btn.primary:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
            }
            
            .slide-action-btn.secondary {
                background: var(--light-bg);
                color: var(--text-secondary);
                border: 1px solid var(--border-color);
            }
            
            .slide-action-btn.secondary:hover {
                background: var(--card-bg);
                color: var(--text-primary);
            }
            
            .slideshow-navigation {
                background: white;
                padding: 1.5rem 2rem;
                border-top: 1px solid var(--border-color);
                display: flex !important;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 9999;
                width: 100%;
                box-sizing: border-box;
            }
            
            .nav-btn {
                display: flex !important;
                align-items: center;
                gap: 0.75rem;
                padding: 0.75rem 1.5rem;
                border: 2px solid var(--border-color);
                border-radius: 0.5rem;
                background: var(--card-bg);
                color: var(--text-primary);
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s ease;
                min-width: 120px;
                visibility: visible !important;
                position: relative;
                z-index: 10000;
                pointer-events: auto;
            }
            
            .nav-btn:hover:not(:disabled) {
                border-color: var(--primary-color);
                background: var(--primary-color);
                color: white;
            }
            
            .nav-btn:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            
            .nav-btn.primary {
                background: var(--gradient-primary);
                color: white;
                border-color: var(--primary-color);
            }
            
            
            .slide-indicators {
                display: flex;
                gap: 0.5rem;
                align-items: center;
            }
            
            .slide-indicator {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                border: none;
                background: var(--border-color);
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            .slide-indicator.active {
                background: var(--primary-color);
                transform: scale(1.2);
            }
            
            .slide-indicator:hover {
                background: var(--primary-color);
                opacity: 0.7;
            }
            
            @media (max-width: 768px) {
                .slideshow-header {
                    padding: 1rem;
                }
                
                .slideshow-content {
                    padding: 1rem;
                }
                
                .slide-title {
                    font-size: 2rem;
                }
                
                .slide-description {
                    font-size: 1.125rem;
                }
                
                .activity-preview {
                    flex-direction: column;
                    text-align: center;
                }
                
                .activity-info {
                    text-align: center;
                }
                
                .slide-actions {
                    flex-direction: column;
                }
                
                .slideshow-navigation {
                    padding: 1rem;
                    flex-wrap: wrap;
                    gap: 1rem;
                }
                
                .slide-indicators {
                    order: -1;
                    width: 100%;
                    justify-content: center;
                }
                
                .journey-highlights {
                    grid-template-columns: 1fr;
                }
                
                .final-certificate {
                    margin: 1rem;
                    padding: 2rem 1rem;
                }
                
                .skills-list {
                    flex-direction: column;
                    align-items: center;
                }
                
                .data-quiz-container, .reflection-questions {
                    padding: 0 1rem;
                }
                
                .quiz-question, .reflection-question {
                    padding: 1rem;
                }
                
                .reflection-summary {
                    margin: 1rem;
                    padding: 1rem;
                }
            }
        `;
        document.head.appendChild(style);
        
        // Video player functions
        function playMainVideo() {
            console.log('Playing main video...');
            const video = document.getElementById('main-video');
            const playBtn = document.getElementById('main-play-btn');
            
            if (video && playBtn) {
                // Show the video and hide play button
                video.style.display = 'block';
                playBtn.style.display = 'none';
                
                // Try to play the video
                const playPromise = video.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log('Video started playing successfully');
                        // Try to go fullscreen after a short delay
                        setTimeout(() => {
                            enterFullscreen(video);
                        }, 500);
                    }).catch(error => {
                        console.log('Video play failed:', error);
                        // Show video anyway for manual play
                    });
                } else {
                    // Older browsers
                    setTimeout(() => {
                        enterFullscreen(video);
                    }, 500);
                }
                
                // Add event listeners (only once)
                if (!video.hasAttribute('data-listeners-added')) {
                    video.addEventListener('ended', function() {
                        console.log('Video ended');
                        playBtn.style.display = 'flex';
                        video.style.display = 'none';
                    });
                    
                    video.addEventListener('pause', function() {
                        console.log('Video paused');
                        // Only hide if video ended
                        if (video.currentTime >= video.duration - 0.1) {
                            playBtn.style.display = 'flex';
                            video.style.display = 'none';
                        }
                    });
                    
                    video.setAttribute('data-listeners-added', 'true');
                }
                
                // Handle fullscreen exit
                addFullscreenListeners();
            }
        }
        
        function playSecondVideo() {
            console.log('Playing second video...');
            const video = document.getElementById('second-video');
            const playBtn = document.getElementById('second-play-btn');
            
            if (video && playBtn) {
                // Show the video and hide play button
                video.style.display = 'block';
                playBtn.style.display = 'none';
                
                // Try to play the video
                const playPromise = video.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log('Second video started playing successfully');
                        // Try to go fullscreen after a short delay
                        setTimeout(() => {
                            enterFullscreen(video);
                        }, 500);
                    }).catch(error => {
                        console.log('Second video play failed:', error);
                        // Show video anyway for manual play
                    });
                } else {
                    // Older browsers
                    setTimeout(() => {
                        enterFullscreen(video);
                    }, 500);
                }
                
                // Add event listeners (only once)
                if (!video.hasAttribute('data-listeners-added')) {
                    video.addEventListener('ended', function() {
                        console.log('Second video ended');
                        playBtn.style.display = 'flex';
                        video.style.display = 'none';
                    });
                    
                    video.addEventListener('pause', function() {
                        console.log('Second video paused');
                        // Only hide if video ended
                        if (video.currentTime >= video.duration - 0.1) {
                            playBtn.style.display = 'flex';
                            video.style.display = 'none';
                        }
                    });
                    
                    video.setAttribute('data-listeners-added', 'true');
                }
                
                // Handle fullscreen exit
                addFullscreenListeners();
            }
        }
        
        function enterFullscreen(video) {
            try {
                if (video.requestFullscreen) {
                    video.requestFullscreen();
                } else if (video.webkitRequestFullscreen) {
                    video.webkitRequestFullscreen();
                } else if (video.mozRequestFullScreen) {
                    video.mozRequestFullScreen();
                } else if (video.msRequestFullscreen) {
                    video.msRequestFullscreen();
                }
                console.log('Requested fullscreen');
            } catch (error) {
                console.log('Fullscreen request failed:', error);
            }
        }
        
        function addFullscreenListeners() {
            // Only add listeners once
            if (!document.hasAttribute('data-fullscreen-listeners')) {
                document.addEventListener('fullscreenchange', handleFullscreenChange);
                document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
                document.addEventListener('mozfullscreenchange', handleFullscreenChange);
                document.addEventListener('MSFullscreenChange', handleFullscreenChange);
                document.setAttribute('data-fullscreen-listeners', 'true');
            }
        }
        
        function handleFullscreenChange() {
            const video = document.getElementById('main-video');
            const playBtn = document.getElementById('main-play-btn');
            
            console.log('Fullscreen change detected');
            
            // Check if we're no longer in fullscreen
            const isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || 
                                   document.mozFullScreenElement || document.msFullscreenElement);
            
            if (!isFullscreen) {
                console.log('Exited fullscreen');
                // If video is paused when exiting fullscreen, hide it and show play button
                if (video && video.paused && video.currentTime < video.duration - 0.1) {
                    video.style.display = 'none';
                    playBtn.style.display = 'flex';
                }
            }
        }

        // Make functions available globally
        window.startActivity = startActivity;
        window.startAssessment = startAssessment;
        window.backToModule = backToModule;
        window.nextQuestion = nextQuestion;
        window.previousQuestion = previousQuestion;
        window.submitQuiz = submitQuiz;
        window.selectAnswer = selectAnswer;
        window.downloadCertificate = downloadCertificate;
        window.startUnit = startUnit;
        window.openActivityWindow = openActivityWindow;
        window.selectDataQuizAnswer = selectDataQuizAnswer;
        window.submitReflections = submitReflections;
        window.continueToFinalAssessment = continueToFinalAssessment;
        window.playMainVideo = playMainVideo;
        window.enterFullscreen = enterFullscreen;
        window.addFullscreenListeners = addFullscreenListeners;
        window.handleFullscreenChange = handleFullscreenChange;
        
        // Slideshow functions
        window.nextSlide = nextSlide;
        window.previousSlide = previousSlide;
        window.goToSlide = goToSlide;
        window.exitSlideshow = exitSlideshow;
        window.playSlideshowVideo = playSlideshowVideo;
        window.startSlideshowActivity = startSlideshowActivity;
        
        // Debug function
        window.testSlideshow = function() {
            console.log('=== SLIDESHOW DEBUG ===');
            console.log('Slideshow mode:', window.slideshowMode);
            console.log('Current slide index:', currentSlideIndex);
            console.log('Slideshow content length:', slideshowContent.length);
            
            const container = document.getElementById('slideshow-container');
            console.log('Slideshow container exists:', !!container);
            
            // Check for duplicate buttons
            const allNextBtns = document.querySelectorAll('#next-slide-btn, [onclick*="nextSlide"]');
            const allPrevBtns = document.querySelectorAll('#prev-slide-btn, [onclick*="previousSlide"]');
            console.log('Total next buttons found:', allNextBtns.length);
            console.log('Total previous buttons found:', allPrevBtns.length);
            
            allNextBtns.forEach((btn, index) => {
                console.log(`Next button ${index + 1}:`, btn);
                console.log(`  - ID: ${btn.id}`);
                console.log(`  - Classes: ${btn.className}`);
                console.log(`  - Parent: ${btn.parentElement?.className}`);
            });
            
            const nextBtn = document.getElementById('next-slide-btn');
            const prevBtn = document.getElementById('prev-slide-btn');
            console.log('Next button by ID exists:', !!nextBtn);
            console.log('Previous button by ID exists:', !!prevBtn);
            
            if (nextBtn) {
                console.log('Next button computed style:', window.getComputedStyle(nextBtn).display);
                console.log('Next button visibility:', window.getComputedStyle(nextBtn).visibility);
            }
            
            const navigation = document.querySelector('.slideshow-navigation');
            console.log('Navigation container exists:', !!navigation);
            if (navigation) {
                console.log('Navigation display:', window.getComputedStyle(navigation).display);
            }
        };
        
        // Data Detective Functions
        function initializeDetectiveDragDrop() {
            // Add drag and drop event listeners
            const studentCards = document.querySelectorAll('.student-card');
            studentCards.forEach(card => {
                card.addEventListener('dragstart', function(e) {
                    e.dataTransfer.setData('text/plain', e.target.dataset.id);
                    e.target.style.opacity = '0.5';
                });
                
                card.addEventListener('dragend', function(e) {
                    e.target.style.opacity = '1';
                });
            });
        }
        
        function allowDrop(ev) {
            ev.preventDefault();
        }
        
        function drop(ev, groupId) {
            ev.preventDefault();
            const studentId = ev.dataTransfer.getData('text/plain');
            const studentCard = document.querySelector(`[data-id="${studentId}"]`);
            const dropzone = ev.currentTarget;
            
            if (studentCard && dropzone) {
                dropzone.appendChild(studentCard);
                dropzone.style.border = '2px dashed #28a745';
                dropzone.style.background = '#e8f5e8';
                dropzone.innerHTML = ''; // Clear placeholder text
            }
        }
        
        function nextDetectiveStep(stepNumber) {
            // Hide current step
            const currentStep = document.querySelector('.detective-step:not([style*="display: none"])');
            if (currentStep) {
                currentStep.style.display = 'none';
            }
            
            // Show next step
            const nextStep = document.getElementById(`step${stepNumber}`);
            if (nextStep) {
                nextStep.style.display = 'block';
                nextStep.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        function completeDetective() {
            // Check if solutions were provided
            const missingStudents = document.getElementById('missing-students').value.trim();
            const additionalInfo = document.getElementById('additional-info').value.trim();
            const fairnessMeasures = document.getElementById('fairness-measures').value.trim();
            
            if (!missingStudents || !additionalInfo || !fairnessMeasures) {
                alert('Please answer all three questions before completing the investigation!');
                return;
            }
            
            // Show completion step
            nextDetectiveStep(5);
        }
        
        function restartDetective() {
            // Reset all steps
            document.querySelectorAll('.detective-step').forEach(step => {
                step.style.display = 'none';
            });
            
            // Reset form data
            document.querySelectorAll('.problem-check').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            document.querySelectorAll('.solution-input').forEach(input => {
                input.value = '';
            });
            
            document.querySelectorAll('.group-label').forEach(label => {
                label.value = '';
            });
            
            // Move all student cards back to original position
            const originalContainer = document.getElementById('student-data');
            const studentCards = document.querySelectorAll('.student-card');
            
            studentCards.forEach(card => {
                originalContainer.appendChild(card);
            });
            
            // Reset dropzones
            document.querySelectorAll('.group-dropzone').forEach(zone => {
                zone.innerHTML = 'Drop students here';
                zone.style.border = '2px dashed #ddd';
                zone.style.background = '#f9f9f9';
            });
            
            // Show first step
            document.getElementById('step1').style.display = 'block';
            document.getElementById('step1').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Make functions globally available
        window.nextDetectiveStep = nextDetectiveStep;
        window.completeDetective = completeDetective;
        window.restartDetective = restartDetective;
        window.allowDrop = allowDrop;
        window.drop = drop;
        window.initializeDetectiveDragDrop = initializeDetectiveDragDrop;
    </script>
</body>
</html>